services:
    _defaults:
        autowire: true
        autoconfigure: true

    # ── UI Layout Resolution ──────────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseBundle\Admin\Layout\SynapseLayoutResolver:
        arguments:
            $layoutMode: '%synapse.ui.layout_mode%'

    # ── Twig Integration ──────────────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseBundle\Admin\Twig\SynapseRuntime:
        tags: ['twig.runtime']

    ArnaudMoncondhuy\SynapseBundle\Admin\Twig\SynapseTwigExtension:
        tags: ['twig.extension']

    ArnaudMoncondhuy\SynapseBundle\MessageHandler\:
        resource: '../src/MessageHandler/'

    # ── Controllers ───────────────────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\ChatUiController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\DashboardController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Core\Controller\Api\ChatApiController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Core\Controller\Api\ConversationApiController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Core\Controller\Api\ResetController:
        tags: ['controller.service_arguments']


    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\ProvidersController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\ModelsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\PresetsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\PresetTestController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\ToolsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\SettingsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\EmbeddingSettingsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\DebugLogsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\DebugController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\AnalyticsController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    ArnaudMoncondhuy\SynapseBundle\Admin\Controller\ConversationController:
        autowire: true
        autoconfigure: true
        tags: ['controller.service_arguments']

    # ── Accounting (Admin feature) ────────────────────────────────────────────
    ArnaudMoncondhuy\SynapseBundle\Core\Accounting\TokenAccountingService: ~

    # ── Debug Logging (Admin override) ─────────────────────────────────────────
    # When admin is enabled, use DoctrineAdminLogger instead of MonologDebugLogger
    # This allows the admin dashboard to see lightweight metadata in the database
    ArnaudMoncondhuy\SynapseBundle\Storage\Logger\DoctrineAdminLogger:
        arguments:
            $em: '@doctrine.orm.entity_manager'
            $repository: '@ArnaudMoncondhuy\SynapseBundle\Storage\Repository\SynapseDebugLogRepository'
        public: false

    # Override the default interface alias to use DoctrineAdminLogger when admin is enabled
    ArnaudMoncondhuy\SynapseBundle\Contract\SynapseDebugLoggerInterface:
        alias: ArnaudMoncondhuy\SynapseBundle\Storage\Logger\DoctrineAdminLogger
