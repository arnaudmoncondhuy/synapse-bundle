{% extends '@Synapse/admin/layout.html.twig' %}

{% block admin_title %}Presets LLM — Synapse Admin{% endblock %}

{% block admin_content %}
<div class="synapse-admin__page">
	<div class="synapse-admin__page-header" style="display: flex; justify-content: space-between; align-items: center">
		<h1 class="synapse-admin__page-title" style="margin: 0;">
			<i data-lucide="sliders-horizontal"></i>
			Presets LLM
		</h1>
		<a href="{{ path('synapse_admin_presets_new') }}" class="synapse-admin__btn synapse-admin__btn--primary" style="white-space: nowrap">
			<i data-lucide="plus"></i>
			Nouveau
		</a>
	</div>

	{% if presets is empty %}
		<div class="synapse-admin__empty" style="text-align: center; padding: 3rem 2rem">
			<i data-lucide="sliders-horizontal" style="width: 64px; height: 64px; color: var(--synapse-admin-text-light); margin-bottom: 1rem; opacity: 0.5"></i>
			<h2 style="margin: 0 0 0.5rem 0; color: var(--synapse-admin-text-muted)">Aucun preset configuré</h2>
			<p style="margin: 0 0 1.5rem 0; color: var(--synapse-admin-text-light); font-size: 0.95rem">
				Créez votre premier preset pour commencer.
			</p>
			<a href="{{ path('synapse_admin_presets_new') }}" class="synapse-admin__btn synapse-admin__btn--primary">
				<i data-lucide="plus"></i> Créer le premier preset
			</a>
		</div>
	{% else %}
		<div class="synapse-admin__grid synapse-admin__grid--2" style="gap: 1.5rem">
			{% for p in presets %}
						{% set preset = p.entity %}
						{% set caps = p.caps %}
						<div class="synapse-admin__card synapse-admin__card--hover"
						     style="border-top: 3px solid {% if preset.isActive %}var(--synapse-admin-success){% else %}var(--synapse-admin-border){% endif %}">

							<!-- Header -->
							<div class="synapse-admin__card-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem">
								<h3 style="margin: 0; font-size: 1.1rem; color: var(--synapse-admin-text-main)">
									{{ preset.name }}
								</h3>
								{% if preset.isActive %}
									<span class="synapse-admin__badge synapse-admin__badge--success" style="white-space: nowrap;">
										<i data-lucide="check-circle" style="width: 14px; height: 14px;"></i>
										Actif
									</span>
								{% endif %}
							</div>

							<!-- Provider & Model -->
							<div class="synapse-admin__card-body" style="border-top: 1px solid var(--synapse-admin-border); border-bottom: 1px solid var(--synapse-admin-border); padding: 1rem 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
								<div>
									<p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; font-weight: 600; color: var(--synapse-admin-text-muted); text-transform: uppercase; letter-spacing: 0.05em">
										<i data-lucide="plug" style="width: 14px; height: 14px; margin-right: 0.25rem; display: inline"></i>
										Provider
									</p>
									<p style="margin: 0; font-size: 0.95rem; font-weight: 600; color: var(--synapse-admin-text-main)">
										{{ preset.providerName|capitalize }}
									</p>
								</div>
								<div>
									<p style="margin: 0 0 0.25rem 0; font-size: 0.75rem; font-weight: 600; color: var(--synapse-admin-text-muted); text-transform: uppercase; letter-spacing: 0.05em">
										<i data-lucide="cpu" style="width: 14px; height: 14px; margin-right: 0.25rem; display: inline"></i>
										Modèle
									</p>
									<code style="font-size: 0.9rem; color: var(--synapse-admin-text-main); font-weight: 500">{{ preset.model }}</code>
								</div>
							</div>

							<!-- Config -->
							<div class="synapse-admin__card-body" style="border-bottom: 1px solid var(--synapse-admin-border); padding: 1rem 1.5rem">
								<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem">
									<p style="margin: 0; font-size: 0.75rem; font-weight: 600; color: var(--synapse-admin-text-muted); text-transform: uppercase; letter-spacing: 0.05em">
										Configuration
									</p>
									<div style="display: flex; gap: 0.5rem">
										{% if caps.thinking and preset.providerOptions.thinking.enabled|default(false) %}<span title="Réflexion active"><i data-lucide="brain" style="width: 14px; color: var(--synapse-admin-success)"></i></span>{% endif %}
										{% if caps.functionCalling %}<span title="Tool calls / Appels d'outils supportés"><i data-lucide="wrench" style="width: 14px; color: var(--synapse-admin-success)"></i></span>{% endif %}
										{% if caps.safetySettings and preset.providerOptions.safety_settings.enabled|default(false) %}<span title="Safety / Filtres de sécurité actifs"><i data-lucide="shield" style="width: 14px; color: var(--synapse-admin-success)"></i></span>{% endif %}
										{% if caps.streaming and preset.streamingEnabled %}<span title="Streaming / Réponses en temps réel"><i data-lucide="activity" style="width: 14px; color: var(--synapse-admin-success)"></i></span>{% endif %}
									</div>
								</div>
								<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.9rem">
									<div style="background: var(--synapse-admin-bg-main); padding: 0.5rem; border-radius: 0.375rem">
										<span style="color: var(--synapse-admin-text-muted)">Temp:</span>
										<strong style="margin-left: 0.25rem; color: var(--synapse-admin-text-main)">{{ preset.generationTemperature }}</strong>
									</div>
									<div style="background: var(--synapse-admin-bg-main); padding: 0.5rem; border-radius: 0.375rem">
										<span style="color: var(--synapse-admin-text-muted)">Réflexion:</span>
										<strong style="margin-left: 0.25rem; color: var(--synapse-admin-text-main)">
											{% if preset.providerOptions.thinking.enabled|default(false) and caps.thinking %}
												{% if preset.providerName == 'gemini' %}
													{{ preset.providerOptions.thinking.budget|default(1024) }}t
												{% elseif preset.providerName == 'ovh' %}
													{{ (preset.providerOptions.thinking.reasoning_effort|default('high'))|capitalize }}
												{% else %}
													Oui
												{% endif %}
											{% else %}
												Non
											{% endif %}
										</strong>
									</div>
								</div>
							</div>

							<!-- Pricing -->
							{% set currency_symbol = (preset.providerName|lower == 'gemini') ? '$' : '€' %}
							<div class="synapse-admin__card-body" style="padding: 1rem 1.5rem; background: var(--synapse-admin-bg-main); font-size: 0.85rem; border-bottom: 1px solid var(--synapse-admin-border)">
								<div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
									<div>
										<span style="display: block; font-size: 0.7rem; font-weight: 600; color: var(--synapse-admin-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem">
											Tarif Input
										</span>
										<span style="color: var(--synapse-admin-text-main); font-weight: 600">
											{% if caps.pricingInput is not null %}
												{{ caps.pricingInput|number_format(2, ',', ' ') }}{{ currency_symbol }} <small style="color: var(--synapse-admin-text-muted); font-weight: normal">/ 1M</small>
											{% else %}
												—
											{% endif %}
										</span>
									</div>
									<div>
										<span style="display: block; font-size: 0.7rem; font-weight: 600; color: var(--synapse-admin-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem">
											Tarif Output
										</span>
										<span style="color: var(--synapse-admin-text-main); font-weight: 600">
											{% if caps.pricingOutput is not null %}
												{{ caps.pricingOutput|number_format(2, ',', ' ') }}{{ currency_symbol }} <small style="color: var(--synapse-admin-text-muted); font-weight: normal">/ 1M</small>
											{% else %}
												—
											{% endif %}
										</span>
									</div>
								</div>
							</div>

							<!-- Actions -->
							<div class="synapse-admin__card-footer" style="padding: 1rem 1.25rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
								{% if not preset.isActive %}
									<form method="post"
									      action="{{ path('synapse_admin_presets_activate', {id: preset.id}) }}"
									      style="display: contents">
										<button type="submit"
										        class="synapse-admin__btn synapse-admin__btn--sm synapse-admin__btn--outline-primary"
										        style="padding-left: 0.8rem; padding-right: 0.8rem; gap: 0.4rem;">
											<i data-lucide="play" style="width: 14px; height: 14px;"></i>
											Activer
										</button>
									</form>
								{% endif %}
								<a href="{{ path('synapse_admin_presets_edit', {id: preset.id}) }}"
								   class="synapse-admin__btn synapse-admin__btn--sm synapse-admin__btn--ghost"
								   style="padding-left: 0.8rem; padding-right: 0.8rem; gap: 0.4rem;">
									<i data-lucide="pencil" style="width: 14px; height: 14px;"></i>
									Modifier
								</a>
								<form method="post"
								      action="{{ path('synapse_admin_presets_test', {id: preset.id}) }}"
								      style="display: contents">
									<button type="submit"
									        class="synapse-admin__btn synapse-admin__btn--sm synapse-admin__btn--ghost"
									        style="padding-left: 0.8rem; padding-right: 0.8rem; gap: 0.4rem;">
										<i data-lucide="flask-conical" style="width: 14px; height: 14px;"></i>
										Tester
									</button>
								</form>
								<form method="post"
								      action="{{ path('synapse_admin_presets_clone', {id: preset.id}) }}"
								      style="display: contents">
									<button type="submit"
									        class="synapse-admin__btn synapse-admin__btn--sm synapse-admin__btn--ghost"
									        style="padding-left: 0.8rem; padding-right: 0.8rem; gap: 0.4rem;">
										<i data-lucide="copy" style="width: 14px; height: 14px;"></i>
										Dupliquer
									</button>
								</form>
								{% if not preset.isActive %}
									<form method="post"
									      action="{{ path('synapse_admin_presets_delete', {id: preset.id}) }}"
									      style="display: contents"
									      onsubmit="return confirm('Supprimer le preset « {{ preset.name }} » ?')">
										<button type="submit"
										        class="synapse-admin__btn synapse-admin__btn--sm synapse-admin__btn--outline-danger"
										        title="Supprimer"
										        style="padding: 0.5rem; height: 35px; min-width: 35px; width: 35px;">
											<i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
										</button>
									</form>
								{% endif %}
							</div>
						</div>
					{% endfor %}
				</div>
	{% endif %}
</div>

<script>
if (typeof lucide !== 'undefined') { lucide.createIcons(); }
</script>
{% endblock %}
