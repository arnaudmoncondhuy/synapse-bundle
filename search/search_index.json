{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Bienvenue sur SynapseBundle \ud83e\udde0","text":"<p>SynapseBundle est un bundle Symfony puissant et flexible con\u00e7u pour int\u00e9grer des capacit\u00e9s d'Intelligence Artificielle (LLM) au c\u0153ur de vos applications.</p>"},{"location":"#pourquoi-synapse","title":"Pourquoi Synapse ?","text":"<ul> <li>Multi-fournisseurs : Support natif pour Google Gemini, OpenAI, Anthropic et d'autres via une architecture de clients abstraite.</li> <li>Pr\u00eat pour la production : Inclut la gestion de l'historique, la persistance Doctrine, et un indicateur de consommation de tokens.</li> <li>Extensible : Cr\u00e9ez vos propres outils (Function Calling), personas et hooks via le syst\u00e8me d'\u00e9v\u00e9nements Symfony.</li> <li>Admin incluse : Un tableau de bord pr\u00eat \u00e0 l'emploi pour surveiller vos conversations et configurer vos mod\u00e8les.</li> </ul>"},{"location":"#installation-rapide","title":"Installation rapide","text":"<pre><code>composer require arnaudmoncondhuy/synapse-bundle\n</code></pre> <p>Ensuite, rendez-vous sur le guide d'Installation pour configurer vos cl\u00e9s API.</p>"},{"location":"#structure-de-la-documentation","title":"Structure de la documentation","text":"<ul> <li>Prise en main : Pour installer et configurer le bundle en quelques minutes.</li> <li>Guides : Pour apprendre \u00e0 utiliser les fonctionnalit\u00e9s avanc\u00e9es (Outils, Personas, etc.).</li> <li>R\u00e9f\u00e9rence Technique : Documentation d\u00e9taill\u00e9e des interfaces et \u00e9v\u00e9nements (auto-g\u00e9n\u00e9r\u00e9e).</li> <li>Architecture : Pour comprendre comment Synapse fonctionne sous le capot.</li> </ul>"},{"location":"changelog/","title":"Changelog","text":"<p>Toutes les modifications importantes de SynapseBundle sont document\u00e9es dans ce fichier.</p> <p>Les modifications importantes sont class\u00e9es par cat\u00e9gorie : - Features : Nouvelles fonctionnalit\u00e9s - Fixes : Corrections de bugs - Refactor : Refactorisations de code - Security : Am\u00e9liorations de s\u00e9curit\u00e9 - Docs : Mises \u00e0 jour de documentation</p>"},{"location":"changelog/#non-classe-developpement-actuel","title":"[Non class\u00e9] \u2014 D\u00e9veloppement actuel","text":""},{"location":"changelog/#features","title":"Features","text":""},{"location":"changelog/#standardisation-sur-le-format-openai-llm-agnosticism","title":"Standardisation sur le format OpenAI (LLM-Agnosticism)","text":"<ul> <li>Refactorisation majeure : ChatService utilise maintenant OpenAI Chat Completions comme format interne standard</li> <li>Impact : Bundle maintenant 100% LLM-agnostique (pr\u00eat pour Mistral, Claude, Ollama, etc.)</li> <li>Changement de format : Message syst\u00e8me int\u00e9gr\u00e9 comme premier \u00e9l\u00e9ment de <code>contents</code> array</li> <li>Avant : <code>systemInstruction</code> (string) + <code>contents</code> (array) s\u00e9par\u00e9s</li> <li>Apr\u00e8s : Tous les messages dans <code>contents</code> avec <code>role: 'system'</code> en t\u00eate (format OpenAI)</li> <li>Clients LLM : Chacun devient un simple \"traducteur\"</li> <li>GeminiClient : Extrait syst\u00e8me de contents, convertit OpenAI\u2192Gemini, traduit les cat\u00e9gories de s\u00e9curit\u00e9</li> <li>OvhAiClient : Passthrough pur (d\u00e9j\u00e0 compatible OpenAI)</li> <li>Nouveaux providers : Impl\u00e9mentation simple en 2-3 heures (juste la couche de conversion)</li> <li>ChatService : Z\u00e9ro logique sp\u00e9cifique au provider (s\u00e9curit\u00e9, safety settings, etc. g\u00e9r\u00e9s par les clients)</li> <li>Chunk format : Changement de <code>blocked_category</code> \u2192 <code>blocked_reason</code> (raison lisible)</li> <li>S\u00e9curit\u00e9 Gemini : Toujours fonctionnelle, traduction d\u00e9plac\u00e9e du centre \u00e0 la p\u00e9riph\u00e9rie</li> </ul> <p>Pour les d\u00e9veloppeurs cr\u00e9ant des clients personnalis\u00e9s : Voir IMPLEMENTATION_GUIDE.md</p>"},{"location":"changelog/#chiffrement-des-credentials-des-providers-llm","title":"Chiffrement des credentials des providers LLM","text":"<ul> <li>Impl\u00e9mentation du chiffrement XSalsa20-Poly1305 pour les credentials (API keys, service account JSON)</li> <li>Chiffrement automatique lors de la sauvegarde via l'interface admin</li> <li>D\u00e9chiffrement transparent lors du chargement en m\u00e9moire</li> <li>Support <code>encryption.enabled: true/false</code> dans la configuration</li> <li>Cl\u00e9s sensibles encrypt\u00e9es : <code>api_key</code>, <code>service_account_json</code>, <code>private_key</code></li> <li>Format de stockage : <code>base64(nonce_24bytes + ciphertext)</code> en BDD</li> <li>Migration progressive : d\u00e9tection automatique des credentials non chiffr\u00e9s lors de la sauvegarde</li> </ul>"},{"location":"changelog/#vidage-des-logs-de-debug","title":"Vidage des logs de debug","text":"<ul> <li>Nouvelle fonctionnalit\u00e9 dans l'interface admin : vidage complet des logs de debug</li> <li>Contr\u00f4le d'acc\u00e8s : accessible aux administrateurs uniquement</li> <li>Endpoint d\u00e9di\u00e9 pour la gestion des logs</li> </ul>"},{"location":"changelog/#support-multi-providers","title":"Support multi-providers","text":"<ul> <li>Google Vertex AI (Gemini 2.5+, 2.0-pro, etc.)</li> <li>OVH AI Endpoints (OpenAI-compatible)</li> <li>Interface admin pour g\u00e9rer les credentials et tester la connexion</li> </ul>"},{"location":"changelog/#interface-dadministration-complete","title":"Interface d'administration compl\u00e8te","text":"<ul> <li>Dashboard avec KPIs (conversations, utilisateurs, tokens, co\u00fbts)</li> <li>Analytics avec graphiques (usage par mod\u00e8le, tendances temporelles)</li> <li>Gestion des presets LLM (cr\u00e9ation, \u00e9dition, test)</li> <li>Gestion des providers (credentials chiffr\u00e9s)</li> <li>Catalogue des mod\u00e8les disponibles</li> <li>Param\u00e8tres globaux (r\u00e9tention RGPD, langue, prompt syst\u00e8me)</li> <li>Logs de debug complets (requ\u00eate/r\u00e9ponse LLM, tokens, safety ratings)</li> </ul>"},{"location":"changelog/#personas-ia","title":"Personas IA","text":"<ul> <li>Support des personnalit\u00e9s IA pr\u00e9d\u00e9finies</li> <li>Fichier JSON configurable (<code>personas_path</code>)</li> <li>Chaque persona : nom, emoji, prompt syst\u00e8me custom</li> </ul>"},{"location":"changelog/#context-caching-gemini","title":"Context Caching (Gemini)","text":"<ul> <li>Support du caching de contexte pour optimiser les co\u00fbts</li> <li>~90% d'\u00e9conomie sur les tokens de contexte r\u00e9utilis\u00e9s</li> </ul>"},{"location":"changelog/#thinking-mode-natif","title":"Thinking Mode natif","text":"<ul> <li>Support du raisonnement Chain-of-Thought (Gemini 2.5+)</li> <li>Configuration : <code>thinking.enabled</code>, <code>thinking.budget</code></li> </ul>"},{"location":"changelog/#token-tracking","title":"Token tracking","text":"<ul> <li>Suivi de la consommation de tokens par mod\u00e8le</li> <li>Calcul automatique des co\u00fbts bas\u00e9 sur la pricing</li> <li>Analytics : co\u00fbts par mod\u00e8le, par utilisateur, par p\u00e9riode</li> </ul>"},{"location":"changelog/#refactoring","title":"Refactoring","text":""},{"location":"changelog/#architecture-domain-driven","title":"Architecture domain-driven","text":"<ul> <li>R\u00e9organisation compl\u00e8te du code source en domaines :</li> <li><code>Core/</code> : logique m\u00e9tier, orchestration LLM</li> <li><code>Admin/</code> : contr\u00f4leurs et UI administration</li> <li><code>Storage/</code> : persistance Doctrine, entit\u00e9s, repositories</li> <li><code>Security/</code> : chiffrement, permissions</li> <li><code>Contract/</code> : interfaces publiques (API du bundle)</li> <li><code>Shared/</code> : code r\u00e9utilisable (enums, models, tools, utils)</li> <li><code>Infrastructure/</code> : DI, commandes CLI, ressources/views</li> </ul>"},{"location":"changelog/#chargement-des-configurations-modeles","title":"Chargement des configurations mod\u00e8les","text":"<ul> <li>Priorisation : dossier <code>Infrastructure/config/models/</code> en premier, fallback sur <code>Core/</code></li> <li>Permet une meilleure organisation des fichiers de configuration</li> </ul>"},{"location":"changelog/#registration-de-debugcontroller","title":"Registration de DebugController","text":"<ul> <li>Enregistrement explicite comme service Symfony</li> <li>Correction : \u00e9tait manquant dans la configuration admin</li> </ul>"},{"location":"changelog/#security","title":"Security","text":""},{"location":"changelog/#chiffrement-des-messages","title":"Chiffrement des messages","text":"<ul> <li>Messages de conversation chiffr\u00e9s en BDD (XSalsa20-Poly1305)</li> <li>D\u00e9chiffrement automatique lors de la lecture</li> <li>Transparent pour l'utilisateur/d\u00e9veloppeur</li> </ul>"},{"location":"changelog/#chiffrement-des-credentials","title":"Chiffrement des credentials","text":"<ul> <li>Credentials des providers chiffr\u00e9s (d\u00e9crit ci-dessus)</li> <li>Migration progressive des credentials existants</li> </ul>"},{"location":"changelog/#controle-dacces","title":"Contr\u00f4le d'acc\u00e8s","text":"<ul> <li>Interface admin prot\u00e9g\u00e9e par r\u00f4le Symfony (<code>ROLE_ADMIN</code>)</li> <li>V\u00e9rification des permissions \u00e0 chaque action</li> </ul>"},{"location":"changelog/#docs","title":"Docs","text":""},{"location":"changelog/#refonte-complete-de-la-documentation","title":"Refonte compl\u00e8te de la documentation","text":"<ul> <li>README.md : rewritten avec 2 providers (Gemini + OVH), vraies options de config</li> <li>docs/configuration.md : r\u00e9f\u00e9rence compl\u00e8te de <code>synapse.yaml</code></li> <li>docs/usage.md : guide d'utilisation avanc\u00e9e (ChatService, outils, events)</li> <li>docs/views.md : int\u00e9gration Twig, layouts, personnalisation CSS</li> <li>docs/changelog.md : ce fichier</li> </ul>"},{"location":"changelog/#notes-de-migration","title":"Notes de migration","text":""},{"location":"changelog/#breaking-changes-standardisation-openai","title":"\u26a0\ufe0f Breaking Changes - Standardisation OpenAI","text":"<p>Si vous avez cr\u00e9\u00e9 un client LLM personnalis\u00e9, vous devez mettre \u00e0 jour ses signatures :</p>"},{"location":"changelog/#1-signatures-des-methodes-llmclientinterface","title":"1. Signatures des m\u00e9thodes (LlmClientInterface)","text":"<p>AVANT : <pre><code>public function generateContent(\n    string $systemInstruction,\n    array $contents,\n    array $tools = [],\n    ?string $model = null,\n    ?array $thinkingConfigOverride = null,\n    array &amp;$debugOut = [],\n): array;\n</code></pre></p> <p>APR\u00c8S : <pre><code>public function generateContent(\n    array $contents,  // \u2190 Contient le syst\u00e8me en [0]\n    array $tools = [],\n    ?string $model = null,\n    ?array $thinkingConfigOverride = null,\n    array &amp;$debugOut = [],\n): array;\n</code></pre></p>"},{"location":"changelog/#2-format-des-messages-openai-canonical","title":"2. Format des messages (OpenAI canonical)","text":"<p>AVANT : syst\u00e8meInstruction s\u00e9par\u00e9 + contents <pre><code>$systemInstruction = \"You are helpful\";\n$contents = [\n    ['role' =&gt; 'user', 'content' =&gt; '...'],\n    ['role' =&gt; 'assistant', 'content' =&gt; '...'],\n];\n</code></pre></p> <p>APR\u00c8S : Tout dans contents, syst\u00e8me en premier <pre><code>$contents = [\n    ['role' =&gt; 'system', 'content' =&gt; 'You are helpful'],    // \u2190 PREMIER\n    ['role' =&gt; 'user', 'content' =&gt; '...'],\n    ['role' =&gt; 'assistant', 'content' =&gt; '...'],\n];\n</code></pre></p>"},{"location":"changelog/#3-format-du-chunk-retourne","title":"3. Format du chunk retourn\u00e9","text":"<p>AVANT : <code>blocked_category</code> (enum Gemini-sp\u00e9cifique) <pre><code>return [\n    'blocked' =&gt; true,\n    'blocked_category' =&gt; 'HARM_CATEGORY_HATE_SPEECH',  // \u2190 Constante Gemini\n];\n</code></pre></p> <p>APR\u00c8S : <code>blocked_reason</code> (string lisible, provider-agnostique) <pre><code>return [\n    'blocked' =&gt; true,\n    'blocked_reason' =&gt; 'discours haineux',  // \u2190 String lisible\n];\n</code></pre></p>"},{"location":"changelog/#4-migration-simple-exemple","title":"4. Migration simple (exemple)","text":"<p>Si vous aviez un client personnalis\u00e9, voici le pattern :</p> <pre><code>class MyLLMClient implements LlmClientInterface {\n    public function generateContent(\n        array $contents,  // \u2190 Nouvelle signature\n        array $tools = [],\n        ?string $model = null,\n        ?array $thinkingConfigOverride = null,\n        array &amp;$debugOut = [],\n    ): array {\n        // 1. Extraire le syst\u00e8me si pr\u00e9sent\n        $systemMessage = '';\n        $contentsWithoutSystem = $contents;\n\n        if (!empty($contents) &amp;&amp; $contents[0]['role'] === 'system') {\n            $systemMessage = $contents[0]['content'];\n            $contentsWithoutSystem = array_slice($contents, 1);\n        }\n\n        // 2. Convertir au format de votre provider\n        $providerMessages = $this-&gt;toProviderFormat($contentsWithoutSystem);\n\n        // 3. Appeler votre API (avec ou sans syst\u00e8me selon le provider)\n        $response = $this-&gt;callApi($systemMessage, $providerMessages, ...);\n\n        // 4. Normaliser la r\u00e9ponse\n        return $this-&gt;normalizeResponse($response);\n    }\n}\n</code></pre> <p>Voir : IMPLEMENTATION_GUIDE.md pour un guide complet.</p>"},{"location":"changelog/#pas-de-changement-requis-pour","title":"\u2705 Pas de changement requis pour","text":"<ul> <li>Configuration (synapse.yaml, presets, safety_settings)</li> <li>Base de donn\u00e9es (sch\u00e9ma inchang\u00e9)</li> <li>Interface admin (UI inchang\u00e9e)</li> <li>Utilisation de ChatService (signatures publiques inchang\u00e9es)</li> <li>Conversations existantes (compatibilit\u00e9 totale)</li> </ul>"},{"location":"changelog/#pour-utiliser-le-chiffrement","title":"Pour utiliser le chiffrement","text":""},{"location":"changelog/#pour-utiliser-le-chiffrement_1","title":"Pour utiliser le chiffrement","text":"<ol> <li>G\u00e9n\u00e9rer une cl\u00e9 : <code>php -r \"echo bin2hex(sodium_crypto_secretbox_keygen());\"</code></li> <li>Ajouter \u00e0 <code>.env.local</code> : <code>SYNAPSE_ENCRYPTION_KEY=base64:...</code></li> <li>Activer dans <code>synapse.yaml</code> :    <pre><code>encryption:\n    enabled: true\n    key: '%env(SYNAPSE_ENCRYPTION_KEY)%'\n</code></pre></li> <li>Les credentials existants seront chiffr\u00e9s automatiquement lors de la prochaine sauvegarde</li> </ol>"},{"location":"changelog/#version-future-envisagee","title":"Version future envisag\u00e9e","text":"<ul> <li>[ ] Support d'autres providers LLM (OpenAI, Anthropic Claude, etc.)</li> <li>[ ] T\u00e9l\u00e9chargement des logs de debug</li> <li>[ ] API publique pour les modules tiers</li> <li>[ ] Webhooks pour les \u00e9v\u00e9nements importants</li> <li>[ ] Syst\u00e8me de plugins</li> </ul>"},{"location":"changelog/#liens-utiles","title":"Liens utiles","text":"<ul> <li>Configuration \u2014 Documentation compl\u00e8te <code>synapse.yaml</code></li> <li>Usage \u2014 Utilisation ChatService, outils, events</li> <li>Int\u00e9gration des vues \u2014 Templates Twig, personnalisation CSS</li> <li>README \u2014 Vue d'ensemble du bundle</li> </ul>"},{"location":"admin/interface/","title":"Interface d'Administration","text":"<p>SynapseBundle inclut une interface d'administration compl\u00e8te pour piloter votre IA en temps r\u00e9el, sans toucher au code.</p>"},{"location":"admin/interface/#acces","title":"\ud83d\ude80 Acc\u00e8s","text":"<p>Par d\u00e9faut, l'interface est accessible via l'URL : <code>/synapse/admin</code>.</p> <p>[!IMPORTANT] S\u00e9curit\u00e9 : L'acc\u00e8s est prot\u00e9g\u00e9 par la configuration <code>synapse.admin_role</code> (par d\u00e9faut <code>ROLE_ADMIN</code>). Assurez-vous d'avoir ce r\u00f4le pour acc\u00e9der aux pages.</p>"},{"location":"admin/interface/#tableau-de-bord-dashboard","title":"\ud83d\udcca Tableau de Bord (Dashboard)","text":"<p>Le point central pour monitorer la sant\u00e9 de votre syst\u00e8me IA : *   KPIs Temps R\u00e9el : Nombre de conversations actives sur les derni\u00e8res 24h. *   Statistiques de Consommation : Suivi pr\u00e9cis du nombre de tokens utilis\u00e9s et estimation du co\u00fbt financier sur 7 jours. *   Graphiques de Tendance : Visualisation de l'usage quotidien sur 30 jours. *   \u00c9tat des Services : Liste des providers (Gemini, OpenAI, etc.) actuellement activ\u00e9s.</p>"},{"location":"admin/interface/#parametres-globaux-settings","title":"\u2699\ufe0f Param\u00e8tres Globaux (Settings)","text":"<p>Cette page permet de configurer le comportement par d\u00e9faut du bundle : *   Langue du Contexte : D\u00e9finit la langue dans laquelle l'IA doit s'exprimer par d\u00e9faut. *   R\u00e9tention RGPD : Nombre de jours avant la purge automatique des messages. *   Prompt Syst\u00e8me Global : Instructions de base qui seront ajout\u00e9es \u00e0 toutes les conversations. *   Mode Debug : Active ou d\u00e9sactive le logging technique approfondi.</p>"},{"location":"admin/interface/#gestion-des-outils-tools","title":"\ud83d\udd27 Gestion des Outils (Tools)","text":"<p>Visualisez tous les outils (<code>AiToolInterface</code>) enregistr\u00e9s dans votre application : *   Inventaire : Liste exhaustive des outils disponibles pour le LLM. *   Inspection de Sch\u00e9ma : V\u00e9rifiez les param\u00e8tres JSON que l'IA doit fournir pour chaque outil. *   Documentation : Affiche les descriptions servies au mod\u00e8le.</p>"},{"location":"admin/interface/#modeles-fournisseurs","title":"\ud83e\udd16 Mod\u00e8les &amp; Fournisseurs","text":"<ul> <li>Providers : Activez ou d\u00e9sactivez vos comptes (OpenAI, Gemini, OvhAi, etc.) et configurez vos cl\u00e9s API de mani\u00e8re s\u00e9curis\u00e9e.</li> <li>Mod\u00e8les : Choisissez vos mod\u00e8les pr\u00e9f\u00e9r\u00e9s, g\u00e9rez leurs capacit\u00e9s (vision, outils) et param\u00e9trez leur tarification pour le calcul des co\u00fbts.</li> </ul>"},{"location":"admin/interface/#personas-presets","title":"\ud83d\udcdd Personas &amp; Presets","text":"<p>Cr\u00e9ez des \"Personnalit\u00e9s\" pr\u00e9configur\u00e9es pour vos utilisateurs : *   Presets : D\u00e9finissez un mod\u00e8le, une temp\u00e9rature et un prompt syst\u00e8me sp\u00e9cifique pour un usage donn\u00e9 (ex: \"Expert SQL\", \"Copywriter Email\"). *   Tests : Un simulateur de chat int\u00e9gr\u00e9 permet de tester vos presets en direct avant de les d\u00e9ployer.</p>"},{"location":"admin/interface/#logs-de-debug","title":"\ud83d\udd0d Logs de Debug","text":"<p>Si le mode debug est activ\u00e9, vous pouvez inspecter chaque \u00e9change technique : *   Payloads API : Voir exactement le JSON envoy\u00e9 et re\u00e7u. *   Flux d'\u00c9v\u00e9nements : Comprendre quel \u00e9v\u00e9nement a \u00e9t\u00e9 d\u00e9clench\u00e9 et \u00e0 quel moment. *   Diagnostics : Identifier rapidement pourquoi un outil n'a pas \u00e9t\u00e9 appel\u00e9 comme pr\u00e9vu.</p>"},{"location":"explanation/architecture/","title":"Architecture &amp; Flux","text":"<p>SynapseBundle repose sur un flux d'ex\u00e9cution s\u00e9quentiel et \u00e9v\u00e8nementiel.</p>"},{"location":"explanation/architecture/#flux-de-generation","title":"Flux de g\u00e9n\u00e9ration","text":"<ol> <li>R\u00e9ception du message via <code>ChatService</code>.</li> <li>Construction du prompt via le <code>PromptBuilder</code>.</li> <li>\u00c9v\u00e9nement <code>SynapsePrePromptEvent</code> : Modification possible du prompt par l'application h\u00f4te.</li> <li>Appel LLM via le client d\u00e9di\u00e9 (Gemini, OpenAI, etc.).</li> <li>Streaming des chunks avec dispatch de <code>SynapseChunkReceivedEvent</code>.</li> <li>D\u00e9tection de Tool Call : Si le LLM demande un outil, Synapse l'ex\u00e9cute et relance une boucle de g\u00e9n\u00e9ration.</li> <li>Finalisation : Enregistrement en base de donn\u00e9es et dispatch de <code>SynapseGenerationCompletedEvent</code>.</li> </ol>"},{"location":"explanation/architecture/#schema-simplifie","title":"Sch\u00e9ma simplifi\u00e9","text":"<pre><code>graph TD\n    User([Message Utilisateur]) --&gt; ChatService\n    ChatService --&gt; PromptBuilder\n    PromptBuilder --&gt; EventPrePrompt{SynapsePrePromptEvent}\n    EventPrePrompt --&gt; LlmClient\n    LlmClient --&gt; Streaming[Streaming des Chunks]\n    Streaming --&gt; EventChunk{SynapseChunkReceivedEvent}\n    Streaming --&gt; ToolCheck{Tool Call ?}\n    ToolCheck -- Oui --&gt; ToolReg[ToolRegistry]\n    ToolReg --&gt; LlmClient\n    ToolCheck -- Non --&gt; End([R\u00e9ponse finale])\n</code></pre>"},{"location":"explanation/security/","title":"S\u00e9curit\u00e9 &amp; RGPD","text":"<p>La s\u00e9curit\u00e9 et la protection des donn\u00e9es sont au c\u0153ur de SynapseBundle.</p>"},{"location":"explanation/security/#chiffrement-des-donnees","title":"Chiffrement des donn\u00e9es","text":"<p>Si activ\u00e9, Synapse utilise libsodium (XSalsa20-Poly1305) pour chiffrer : - Les messages des utilisateurs en base de donn\u00e9es. - Les credentials des providers (cl\u00e9s API, JSON de service account).</p>"},{"location":"explanation/security/#rgpd-retention-des-donnees","title":"RGPD : R\u00e9tention des donn\u00e9es","text":"<p>Le bundle inclut une commande de purge automatique (<code>synapse:purge</code>) qui doit \u00eatre configur\u00e9e en t\u00e2che CRON pour respecter la dur\u00e9e de conservation maximale de 30 jours (ou plus selon votre config).</p>"},{"location":"explanation/security/#controle-dacces","title":"Contr\u00f4le d'acc\u00e8s","text":"<p>L'administration est s\u00e9curis\u00e9e par le syst\u00e8me de s\u00e9curit\u00e9 de Symfony : - R\u00f4le par d\u00e9faut : <code>ROLE_ADMIN</code>. - Possibilit\u00e9 d'impl\u00e9menter <code>PermissionCheckerInterface</code> pour des r\u00e8gles plus fines.</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Ce guide vous accompagne dans l'installation et la configuration initiale de SynapseBundle.</p>"},{"location":"getting-started/installation/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>PHP 8.2 ou sup\u00e9rieur</li> <li>Symfony 7.0 / 8.0</li> <li>Doctrine ORM (si vous souhaitez utiliser la persistance des conversations)</li> </ul>"},{"location":"getting-started/installation/#1-installation-du-packgaqe","title":"1. Installation du packgaqe","text":"<p>Utilisez Composer pour ajouter le bundle \u00e0 votre projet :</p> <pre><code>composer require arnaudmoncondhuy/synapse-bundle\n</code></pre>"},{"location":"getting-started/installation/#2-creation-des-entites-optionnel-mais-recommande","title":"2. Cr\u00e9ation des entit\u00e9s (Optionnel mais recommand\u00e9)","text":"<p>Si vous souhaitez enregistrer les conversations en base de donn\u00e9es, vous devez cr\u00e9er deux entit\u00e9s dans votre application qui \u00e9tendent les classes de base du bundle.</p>"},{"location":"getting-started/installation/#entite-conversation","title":"Entit\u00e9 Conversation","text":"<pre><code>// src/Entity/Conversation.php\nnamespace App\\Entity;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Storage\\Entity\\SynapseConversation;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\nclass Conversation extends SynapseConversation\n{\n    #[ORM\\Id, ORM\\GeneratedValue, ORM\\Column]\n    private ?int $id = null;\n\n    public function getId(): ?int { return $this-&gt;id; }\n}\n</code></pre>"},{"location":"getting-started/installation/#entite-message","title":"Entit\u00e9 Message","text":"<pre><code>// src/Entity/Message.php\nnamespace App\\Entity;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Storage\\Entity\\SynapseMessage;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\nclass Message extends SynapseMessage\n{\n    #[ORM\\Id, ORM\\GeneratedValue, ORM\\Column]\n    private ?int $id = null;\n\n    public function getId(): ?int { return $this-&gt;id; }\n}\n</code></pre>"},{"location":"getting-started/installation/#3-configuration-minimale","title":"3. Configuration minimale","text":"<p>Cr\u00e9ez le fichier de configuration <code>config/packages/synapse.yaml</code> :</p> <pre><code>synapse:\n    persistence:\n        enabled: true\n        conversation_class: App\\Entity\\Conversation\n        message_class: App\\Entity\\Message\n\n    admin:\n        enabled: true\n</code></pre>"},{"location":"getting-started/installation/#4-mise-a-jour-de-la-base-de-donnees","title":"4. Mise \u00e0 jour de la base de donn\u00e9es","text":"<p>G\u00e9n\u00e9rez et ex\u00e9cutez une migration pour cr\u00e9er les tables n\u00e9cessaires :</p> <pre><code>php bin/console make:migration\nphp bin/console doctrine:migrations:migrate\n</code></pre>"},{"location":"getting-started/installation/#5-acces-a-ladministration","title":"5. Acc\u00e8s \u00e0 l'administration","text":"<p>Une fois install\u00e9, vous pouvez acc\u00e9der \u00e0 l'interface d'administration pour configurer vos providers (Gemini, OpenAI, etc.) :</p> <p>URL par d\u00e9faut : <code>/synapse/admin</code></p> <p>[!NOTE] Par d\u00e9faut, l'acc\u00e8s est r\u00e9serv\u00e9 aux utilisateurs ayant le r\u00f4le <code>ROLE_ADMIN</code>.</p>"},{"location":"getting-started/quickstart/","title":"Guide rapide (Quickstart)","text":"<p>Une fois le bundle install\u00e9, vous pouvez commencer \u00e0 interagir avec les LLM en utilisant le service <code>ChatService</code>.</p>"},{"location":"getting-started/quickstart/#1-injecter-le-service","title":"1. Injecter le service","text":"<p>Dans votre contr\u00f4leur ou service, injectez <code>ArnaudMoncondhuy\\SynapseBundle\\Core\\Chat\\ChatService</code>.</p> <pre><code>namespace App\\Controller;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Core\\Chat\\ChatService;\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\Routing\\Annotation\\Route;\n\nclass ChatController extends AbstractController\n{\n    #[Route('/ask', name: 'app_chat_ask')]\n    public function ask(ChatService $chatService): Response\n    {\n        $result = $chatService-&gt;ask(\"Bonjour, comment vas-tu ?\");\n\n        return $this-&gt;json([\n            'answer' =&gt; $result['answer']\n        ]);\n    }\n}\n</code></pre>"},{"location":"getting-started/quickstart/#2-structure-de-la-reponse","title":"2. Structure de la r\u00e9ponse","text":"<p>La m\u00e9thode <code>ask()</code> retourne un tableau contenant :</p> <ul> <li><code>answer</code> : La r\u00e9ponse textuelle du mod\u00e8le.</li> <li><code>usage</code> : D\u00e9tails sur les tokens consomm\u00e9s (prompt, completion).</li> <li><code>model</code> : Le nom du mod\u00e8le utilis\u00e9.</li> <li><code>debug_id</code> : Un identifiant unique si le mode debug est activ\u00e9.</li> </ul>"},{"location":"getting-started/quickstart/#3-options-courantes","title":"3. Options courantes","text":"<p>Vous pouvez passer un tableau d'options en deuxi\u00e8me argument de <code>ask()</code> :</p> <pre><code>$result = $chatService-&gt;ask(\"Explique-moi la relativit\u00e9\", [\n    'persona' =&gt; 'scientifique',  // Utiliser un persona sp\u00e9cifique\n    'stateless' =&gt; true,          // Ne pas enregistrer en BDD\n    'history' =&gt; $myHistory,      // Passer un historique manuel\n]);\n</code></pre>"},{"location":"getting-started/quickstart/#et-apres","title":"Et apr\u00e8s ?","text":"<ul> <li>Apprenez \u00e0 Cr\u00e9er des outils IA pour donner du pouvoir \u00e0 votre chatbot.</li> <li>Configurez vos Personas pour ajuster le ton de l'IA.</li> <li>D\u00e9couvrez comment G\u00e9rer les Conversations persist\u00e9es.</li> </ul>"},{"location":"guides/ai-tools/","title":"Cr\u00e9er des outils IA (Function Calling)","text":"<p>Les outils permettent au LLM d'appeler des fonctions de votre application pour r\u00e9cup\u00e9rer des donn\u00e9es en temps r\u00e9el ou effectuer des actions.</p>"},{"location":"guides/ai-tools/#1-implementer-linterface","title":"1. Impl\u00e9menter l'interface","text":"<p>Cr\u00e9ez une classe qui impl\u00e9mente <code>ArnaudMoncondhuy\\SynapseBundle\\Contract\\AiToolInterface</code>.</p>"},{"location":"guides/ai-tools/#exemple-outil-de-calcul-de-prix","title":"Exemple : Outil de calcul de prix","text":"<pre><code>namespace App\\Tool;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\AiToolInterface;\n\nclass PriceCalculatorTool implements AiToolInterface\n{\n    public function getName(): string\n    {\n        return 'calculate_total';\n    }\n\n    public function getDescription(): string\n    {\n        return 'Calcule le prix TTC \u00e0 partir du HT. Utiliser cet outil quand l\\'utilisateur demande un prix final.';\n    }\n\n    public function getInputSchema(): array\n    {\n        return [\n            'type' =&gt; 'object',\n            'properties' =&gt; [\n                'ht_price' =&gt; ['type' =&gt; 'number', 'description' =&gt; 'Prix hors taxes'],\n                'tva_rate' =&gt; ['type' =&gt; 'number', 'description' =&gt; 'Taux de TVA (ex: 20)'],\n            ],\n            'required' =&gt; ['ht_price', 'tva_rate'],\n        ];\n    }\n\n    public function execute(array $parameters): mixed\n    {\n        return $parameters['ht_price'] * (1 + $parameters['tva_rate'] / 100);\n    }\n}\n</code></pre>"},{"location":"guides/ai-tools/#2-enregistrement-des-outils","title":"2. Enregistrement des outils","text":"<p>Le bundle utilise l'auto-configuration. Vous devez simplement taguer vos services avec <code>synapse.tool</code> (souvent automatique via <code>_instanceof</code> dans <code>services.yaml</code>).</p> <pre><code># config/services.yaml\nservices:\n    _instanceof:\n        ArnaudMoncondhuy\\SynapseBundle\\Contract\\AiToolInterface:\n            tags: ['synapse.tool']\n</code></pre>"},{"location":"guides/ai-tools/#3-utilisation","title":"3. Utilisation","text":"<p>Une fois l'outil enregistr\u00e9, le LLM d\u00e9cidera automatiquement de l'appeler si la question de l'utilisateur correspond \u00e0 la description de l'outil.</p> <p>[!TIP] Plus votre <code>description</code> est pr\u00e9cise, plus le LLM sera efficace pour choisir le bon outil au bon moment.</p>"},{"location":"guides/configuration/","title":"Configuration d\u00e9taill\u00e9e","text":"<p>Toute la configuration du bundle se fait dans le fichier <code>config/packages/synapse.yaml</code>.</p>"},{"location":"guides/configuration/#reference-des-options","title":"R\u00e9f\u00e9rence des options","text":""},{"location":"guides/configuration/#persistance-persistence","title":"Persistance (<code>persistence</code>)","text":"<p>Permet d'enregistrer les conversations et messages en base de donn\u00e9es.</p> Option Type D\u00e9faut Description <code>enabled</code> bool <code>false</code> Activer la persistance Doctrine. <code>conversation_class</code> string <code>null</code> FQCN de votre entit\u00e9 Conversation (ex: <code>App\\Entity\\Conversation</code>). <code>message_class</code> string <code>null</code> FQCN de votre entit\u00e9 Message."},{"location":"guides/configuration/#securite-security","title":"S\u00e9curit\u00e9 (<code>security</code>)","text":"<p>G\u00e8re les acc\u00e8s \u00e0 l'administration et au chat.</p> Option Type D\u00e9faut Description <code>admin_role</code> string <code>ROLE_ADMIN</code> Le r\u00f4le requis pour acc\u00e9der \u00e0 <code>/synapse/admin</code>. <code>permission_checker</code> string <code>default</code> Service utilis\u00e9 pour v\u00e9rifier les droits d'acc\u00e8s."},{"location":"guides/configuration/#chiffrement-encryption","title":"Chiffrement (<code>encryption</code>)","text":"<p>Pour s\u00e9curiser vos cl\u00e9s API et vos messages en base de donn\u00e9es.</p> <pre><code>synapse:\n    encryption:\n        enabled: true\n        key: '%env(SYNAPSE_ENCRYPTION_KEY)%'\n</code></pre> <p>[!WARNING] N'activez le chiffrement que si vous avez configur\u00e9 une cl\u00e9 32 bytes valide.</p>"},{"location":"guides/configuration/#retention-rgpd-retention","title":"R\u00e9tention RGPD (<code>retention</code>)","text":"<p>Suppression automatique des anciennes conversations.</p> Option Type D\u00e9faut Description <code>days</code> int <code>30</code> Nombre de jours avant que les conversations ne soient purg\u00e9es par <code>synapse:purge</code>."},{"location":"guides/configuration/#variables-denvironnement","title":"Variables d'environnement","text":"<p>Voici les variables recommand\u00e9es \u00e0 d\u00e9finir dans votre <code>.env</code> :</p> <pre><code># Cl\u00e9 de chiffrement (32 bytes)\nSYNAPSE_ENCRYPTION_KEY=...\n# R\u00f4le admin custom\nSYNAPSE_ADMIN_ROLE=ROLE_SUPER_ADMIN\n</code></pre>"},{"location":"guides/configuration/#verification","title":"V\u00e9rification","text":"<p>Vous pouvez voir la configuration finale r\u00e9solue par Symfony avec la commande :</p> <pre><code>php bin/console config:dump synapse\n</code></pre>"},{"location":"guides/personas-presets/","title":"Personas &amp; Presets","text":"<p>SynapseBundle vous permet de contr\u00f4ler finement le comportement du LLM via deux concepts : les Personas et les Presets.</p>"},{"location":"guides/personas-presets/#1-les-personas","title":"1. Les Personas","text":"<p>Un persona d\u00e9finit l'identit\u00e9, le ton et les instructions syst\u00e8me de l'IA.</p>"},{"location":"guides/personas-presets/#configuration-via-json","title":"Configuration via JSON","text":"<p>Par d\u00e9faut, le bundle utilise ses propres personas. Vous pouvez fournir votre propre fichier via la configuration :</p> <pre><code># config/packages/synapse.yaml\nsynapse:\n    personas_path: '%kernel.project_dir%/config/personas.json'\n</code></pre>"},{"location":"guides/personas-presets/#format-du-fichier-personasjson","title":"Format du fichier <code>personas.json</code>","text":"<pre><code>{\n    \"support\": {\n        \"name\": \"Conseiller Client\",\n        \"emoji\": \"\ud83c\udfa7\",\n        \"system_prompt\": \"Tu es un agent support courtois. Aide l'utilisateur avec ses commandes.\"\n    }\n}\n</code></pre>"},{"location":"guides/personas-presets/#2-les-presets","title":"2. Les Presets","text":"<p>Un preset est une configuration technique (mod\u00e8le cible, temp\u00e9rature, outils activ\u00e9s) enregistr\u00e9e en base de donn\u00e9es via l'administration.</p> <ul> <li>Mod\u00e8le : Gemini 2.0 Flash, OpenAI GPT-4o, etc.</li> <li>Param\u00e8tres : Max tokens, Top-P, Temp\u00e9rature.</li> <li>Outils : S\u00e9lection des outils autoris\u00e9s pour ce preset.</li> </ul>"},{"location":"guides/personas-presets/#utilisation-en-php","title":"Utilisation en PHP","text":"<pre><code>$chatService-&gt;ask(\"Bonjour\", [\n    'persona' =&gt; 'support',\n    'preset' =&gt; $myPresetObject\n]);\n</code></pre> <p>[!TIP] Vous pouvez lister les personas disponibles dans vos templates Twig avec la fonction : <code>synapse_get_personas()</code>.</p>"},{"location":"guides/rle-management/","title":"Conversations &amp; Persistance","text":"<p>SynapseBundle g\u00e8re automatiquement l'historique des \u00e9changes pour maintenir le contexte de la discussion.</p>"},{"location":"guides/rle-management/#1-mode-persistant-doctrine","title":"1. Mode Persistant (Doctrine)","text":"<p>Si la persistance est activ\u00e9e dans <code>synapse.yaml</code>, chaque appel \u00e0 <code>ChatService::ask()</code> enregistre les messages dans les tables <code>conversation</code> et <code>message</code>.</p>"},{"location":"guides/rle-management/#reprendre-une-conversation","title":"Reprendre une conversation","text":"<p>Il suffit de passer le <code>conversation_id</code> dans les options :</p> <pre><code>$result = $chatService-&gt;ask(\"Quelle est la suite ?\", [\n    'conversation_id' =&gt; '01AN4V0... (ULID)'\n]);\n</code></pre>"},{"location":"guides/rle-management/#2-mode-sans-etat-stateless","title":"2. Mode Sans \u00c9tat (Stateless)","text":"<p>Si vous ne souhaitez pas enregistrer l'\u00e9change (par exemple pour un test ou un appel one-shot), utilisez l'option <code>stateless</code> :</p> <pre><code>$result = $chatService-&gt;ask(\"Bonjour\", [\n    'stateless' =&gt; true\n]);\n</code></pre>"},{"location":"guides/rle-management/#3-gestion-manuelle-de-lhistorique","title":"3. Gestion manuelle de l'historique","text":"<p>Vous pouvez \u00e9galement injecter votre propre historique sans utiliser la base de donn\u00e9es :</p> <pre><code>$history = [\n    ['role' =&gt; 'user', 'content' =&gt; 'Bonjour'],\n    ['role' =&gt; 'assistant', 'content' =&gt; 'Bonjour ! Comment puis-je vous aider ?']\n];\n\n$result = $chatService-&gt;ask(\"Quelle heure est-il ?\", [\n    'history' =&gt; $history\n]);\n</code></pre>"},{"location":"guides/rle-management/#4-nettoyage-rgpd","title":"4. Nettoyage (RGPD)","text":"<p>Pour respecter le RGPD, vous pouvez purger les anciennes conversations via la commande CLI :</p> <pre><code># Purge les conversations de plus de 30 jours\nphp bin/console synapse:purge\n</code></pre>"},{"location":"reference/chat-service/","title":"ChatService","text":"<p>Le <code>ChatService</code> est le point d'entr\u00e9e principal de SynapseBundle. C'est l'orchestrateur qui g\u00e8re la communication avec le LLM, la gestion du contexte, l'appel des outils et le streaming.</p>"},{"location":"reference/chat-service/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Simplicit\u00e9 : Envoyez un message et recevez une r\u00e9ponse IA avec une seule ligne de code.</li> <li>Orchestration automatique : Il g\u00e8re pour vous le cycle de vie des promps, les it\u00e9rations d'outils et le stockage des messages.</li> <li>Performance : Supporte nativement le streaming pour une exp\u00e9rience utilisateur fluide.</li> </ul>"},{"location":"reference/chat-service/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>ask(string $message, array $options)</code> Message brut <code>string</code> D\u00e9clenche un \u00e9change complet avec le LLM."},{"location":"reference/chat-service/#utilisation-classique","title":"\ud83d\ude80 Utilisation classique","text":"<p>Voici comment utiliser le service dans un contr\u00f4leur Symfony.</p> ChatController.php <pre><code>namespace App\\Controller;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Core\\Chat\\ChatService;\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;\nuse Symfony\\Component\\HttpFoundation\\Response;\n\nclass ChatController extends AbstractController\n{\n    public function index(ChatService $chatService): Response\n    {\n        $response = $chatService-&gt;ask(\"Bonjour, peux-tu m'aider ?\", [\n            'model' =&gt; 'gemini-1.5-flash',\n            'temperature' =&gt; 0.7,\n            'stream' =&gt; false\n        ]);\n\n        return new Response($response);\n    }\n}\n</code></pre>"},{"location":"reference/chat-service/#options-disponibles","title":"\u2699\ufe0f Options disponibles","text":"<p>La m\u00e9thode <code>ask()</code> accepte un tableau d'options pour personnaliser l'\u00e9change :</p> <ul> <li><code>model</code> : Identifiant technique du mod\u00e8le LLM \u00e0 utiliser.</li> <li><code>temperature</code> : (float) Entre 0.0 et 1.0 (cr\u00e9ativit\u00e9).</li> <li><code>stream</code> : (bool) Si vrai, le service \u00e9mettra des \u00e9v\u00e9nements pour chaque token re\u00e7u.</li> <li><code>max_output_tokens</code> : Limite la longueur de la r\u00e9ponse.</li> <li><code>debug</code> : (bool) Active le logging d\u00e9taill\u00e9 de l'\u00e9change.</li> </ul>"},{"location":"reference/chat-service/#conseils-dutilisation","title":"\ud83d\udca1 Conseils d'utilisation","text":"<p>[!TIP] Streaming : Pour utiliser le streaming, passez <code>stream: true</code> et \u00e9coutez l'\u00e9v\u00e9nement <code>SynapseChunkReceivedEvent</code>. Cela permet d'afficher la r\u00e9ponse au fur et \u00e0 mesure qu'elle arrive, comme sur ChatGPT.</p>"},{"location":"reference/cli/","title":"Commandes CLI","text":"<p>Le bundle fournit des commandes pour la maintenance et le debug.</p>"},{"location":"reference/cli/#synapsepurge","title":"<code>synapse:purge</code>","text":"<p>Purge les conversations trop anciennes selon la politique de r\u00e9tention d\u00e9finie dans <code>synapse.yaml</code>.</p> <pre><code># Simulation\nphp bin/console synapse:purge --dry-run\n# Purge r\u00e9elle\nphp bin/console synapse:purge\n</code></pre>"},{"location":"reference/cli/#synapsetest-preset-interne","title":"<code>synapse:test-preset</code> (Interne)","text":"<p>Utilis\u00e9 par l'interface d'administration pour valider qu'un preset est fonctionnel avant son activation.</p>"},{"location":"reference/conversation-manager/","title":"ConversationManager","text":"<p>Le <code>ConversationManager</code> est le gardien de l'historique et de la s\u00e9curit\u00e9 des donn\u00e9es. Il permet de manipuler les discussions, de les chiffrer et de s'assurer que seuls les utilisateurs autoris\u00e9s y ont acc\u00e8s.</p>"},{"location":"reference/conversation-manager/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>CRUD Facile : Cr\u00e9ez, r\u00e9cup\u00e9rez ou supprimez des conversations en une m\u00e9thode.</li> <li>S\u00e9curit\u00e9 int\u00e9gr\u00e9e : Le chiffrement et la v\u00e9rification des permissions sont appliqu\u00e9s automatiquement.</li> <li>Context Thread-Local : Garde en m\u00e9moire la conversation \"active\" pour faciliter vos traitements.</li> </ul>"},{"location":"reference/conversation-manager/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>createConversation(...)</code> Initialise un nouveau fil de discussion persistant. <code>saveMessage(...)</code> Enregistre un message utilisateur ou assistant. <code>getMessages(...)</code> R\u00e9cup\u00e8re l'historique (d\u00e9chiffr\u00e9 automatiquement). <code>getConversation(...)</code> R\u00e9cup\u00e8re une conversation avec v\u00e9rification des droits."},{"location":"reference/conversation-manager/#exemple-gestion-manuelle-dune-conversation","title":"\ud83d\ude80 Exemple : Gestion manuelle d'une conversation","text":"ConversationService.php <pre><code>namespace App\\Service;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Core\\Manager\\ConversationManager;\nuse ArnaudMoncondhuy\\SynapseBundle\\Shared\\Enum\\MessageRole;\n\nclass ConversationService\n{\n    public function __construct(private ConversationManager $manager) {}\n\n    public function initChat($user)\n    {\n        // Cr\u00e9er\n        $conv = $this-&gt;manager-&gt;createConversation($user, \"Ma discussion\");\n\n        // Ajouter un message syst\u00e8me\n        $this-&gt;manager-&gt;saveMessage($conv, MessageRole::SYSTEM, \"Tu es un assistant utile.\");\n\n        return $conv;\n    }\n}\n</code></pre>"},{"location":"reference/conversation-manager/#conseils-dutilisation","title":"\ud83d\udca1 Conseils d'utilisation","text":"<p>[!IMPORTANT] Chiffrement : Si vous avez configur\u00e9 un <code>EncryptionServiceInterface</code>, le <code>ConversationManager</code> chiffrera le contenu des messages avant de les envoyer en base de donn\u00e9es sans aucune action de votre part.</p> <ul> <li>Permissions : Utilisez toujours <code>getConversation()</code> plut\u00f4t que de passer par le repository Doctrine directement, afin de b\u00e9n\u00e9ficier de la validation de s\u00e9curit\u00e9 automatique.</li> </ul>"},{"location":"reference/entities/","title":"Entit\u00e9s Doctrine","text":"<p>SynapseBundle utilise des <code>MappedSuperclass</code> que vous devez \u00e9tendre dans votre application pour activer la persistance.</p>"},{"location":"reference/entities/#entites-principales","title":"Entit\u00e9s principales","text":"<ul> <li>SynapseConversation : Stocke les m\u00e9tadonn\u00e9es de la discussion (titre, propri\u00e9taire, date).</li> <li>SynapseMessage : Stocke le contenu des \u00e9changes (r\u00f4le, contenu texte, calls outils).</li> </ul>"},{"location":"reference/entities/#entites-de-configuration","title":"Entit\u00e9s de configuration","text":"<ul> <li>SynapsePreset : Configuration technique d'un mod\u00e8le (temp\u00e9rature, outils, etc.).</li> <li>SynapseProvider : Credentials chiffr\u00e9s pour les fournisseurs (Gemini, OpenAI).</li> </ul> <p>[!NOTE] Reportez-vous au guide de Persistance pour les d\u00e9tails d'impl\u00e9mentation.</p>"},{"location":"reference/contracts/agent-interface/","title":"AgentInterface","text":"<p>L'interface <code>AgentInterface</code> d\u00e9finit des entit\u00e9s d'IA autonomes et sp\u00e9cialis\u00e9es. Contrairement \u00e0 un simple appel LLM, un Agent poss\u00e8de son propre \"cerveau\" (Prompt Syst\u00e8me), ses propres outils et un mode de pens\u00e9e sp\u00e9cifique.</p>"},{"location":"reference/contracts/agent-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Sp\u00e9cialisation : Cr\u00e9ez un agent \"Expert SQL\", un agent \"Traducteur\" et un agent \"Support Client\" avec des comportements distincts.</li> <li>Autonomie : Un agent peut d\u00e9cider lui-m\u00eame d'appeler plusieurs outils \u00e0 la suite pour r\u00e9soudre un probl\u00e8me complexe.</li> <li>R\u00e9utilisabilit\u00e9 : Encapsulez toute la logique complexe de prompt engineering dans une classe d\u00e9di\u00e9e.</li> </ul>"},{"location":"reference/contracts/agent-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode R\u00f4le <code>getName()</code> Nom affichable de l'agent. <code>getSystemPrompt()</code> La \"personnalit\u00e9\" et les instructions de base de l'agent. <code>getTools()</code> Liste des instances <code>AiToolInterface</code> que cet agent peut utiliser. <code>getLlmConfig()</code> Param\u00e8tres sp\u00e9cifiques (temp\u00e9rature \u00e9lev\u00e9e pour la cr\u00e9ation, basse pour la pr\u00e9cision)."},{"location":"reference/contracts/agent-interface/#exemple-agent-ange-gardien-de-securite","title":"\ud83d\ude80 Exemple : Agent \"Ange Gardien\" de s\u00e9curit\u00e9","text":"GuardianAgent.php <pre><code>namespace App\\Synapse\\Agent;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\AgentInterface;\n\nclass GuardianAgent implements AgentInterface\n{\n    public function getName(): string { return 'Guardian'; }\n\n    public function getSystemPrompt(): string\n    {\n        return \"Tu es un expert en s\u00e9curit\u00e9. Ton r\u00f4le est d'analyser les messages pour d\u00e9tecter des contenus dangereux ou inappropri\u00e9s.\";\n    }\n\n    public function getTools(): array \n    {\n        return []; // Un agent peut n'avoir aucun outil\n    }\n\n    public function getLlmConfig(): array\n    {\n        return ['temperature' =&gt; 0.1]; // Tr\u00e8s pr\u00e9cis, peu cr\u00e9atif\n    }\n}\n</code></pre>"},{"location":"reference/contracts/agent-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!TIP] Agents dynamiques : Vous pouvez impl\u00e9menter cette interface sur une entit\u00e9 Doctrine pour permettre la cr\u00e9ation d'agents personnalis\u00e9s directement depuis votre interface d'administration.</p> <ul> <li>Prompt Engineering : Le texte retourn\u00e9 par <code>getSystemPrompt</code> est inject\u00e9 au sommet de chaque conversation. C'est ici que vous devez d\u00e9finir les limites et le ton de l'intelligence.</li> </ul>"},{"location":"reference/contracts/ai-tool-interface/","title":"AiToolInterface","text":"<p>L'interface <code>AiToolInterface</code> est le point d'entr\u00e9e pour \u00e9tendre les capacit\u00e9s de votre IA (Function Calling). Elle permet au mod\u00e8le de sortir de sa \"bulle\" de texte pour interagir avec votre syst\u00e8me : base de donn\u00e9es, API tierces, ou calculs complexes.</p>"},{"location":"reference/contracts/ai-tool-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Acc\u00e8s aux donn\u00e9es : Permettre \u00e0 l'IA de consulter les stocks, les prix ou les profils utilisateurs.</li> <li>Actions concr\u00e8tes : Envoyer un email, cr\u00e9er un ticket support ou d\u00e9clencher un export.</li> <li>Fiabilit\u00e9 : Confier les calculs math\u00e9matiques ou les requ\u00eates SQL pr\u00e9cises \u00e0 votre code PHP plut\u00f4t qu'\u00e0 l'imagination du LLM.</li> </ul>"},{"location":"reference/contracts/ai-tool-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode R\u00f4le Importance pour l'IA <code>getName()</code> Identifiant technique unique. Crucial pour l'appel. <code>getDescription()</code> Explication en langage naturel de ce que fait l'outil. D\u00e9termine quand l'IA choisit d'utiliser cet outil. <code>getInputSchema()</code> Structure attendue des arguments (JSON Schema). Guide l'IA pour qu'elle fournisse les bons param\u00e8tres. <code>execute(array $params)</code> Votre logique m\u00e9tier PHP. Le r\u00e9sultat sera renvoy\u00e9 au mod\u00e8le."},{"location":"reference/contracts/ai-tool-interface/#exemple-outil-de-consultation-meteo","title":"\ud83d\ude80 Exemple : Outil de consultation m\u00e9t\u00e9o","text":"<p>Voici comment impl\u00e9menter un outil simple mais robuste.</p> WeatherTool.php <pre><code>namespace App\\Synapse\\Tool;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\AiToolInterface;\n\nclass WeatherTool implements AiToolInterface\n{\n    public function getName(): string\n    {\n        return 'get_current_weather';\n    }\n\n    public function getDescription(): string\n    {\n        return 'R\u00e9cup\u00e8re la m\u00e9t\u00e9o actuelle pour une ville donn\u00e9e afin d\\'informer l\\'utilisateur.';\n    }\n\n    public function getInputSchema(): array\n    {\n        return [\n            'type' =&gt; 'object',\n            'properties' =&gt; [\n                'location' =&gt; [\n                    'type' =&gt; 'string',\n                    'description' =&gt; 'La ville et l\\'\u00e9tat, ex: Paris, FR',\n                ],\n                'unit' =&gt; [\n                    'type' =&gt; 'string',\n                    'enum' =&gt; ['celsius', 'fahrenheit'],\n                ],\n            ],\n            'required' =&gt; ['location'],\n        ];\n    }\n\n    public function execute(array $parameters): mixed\n    {\n        $location = $parameters['location'];\n        // Votre logique d'appel API (ex: OpenWeatherMap)\n        return \"Il fait 22\u00b0C et grand soleil \u00e0 \" . $location;\n    }\n}\n</code></pre>"},{"location":"reference/contracts/ai-tool-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!TIP] Soignez la description ! Le LLM ne lit pas votre code PHP. Sa seule fa\u00e7on de savoir s'il doit appeler votre outil est de lire le texte renvoy\u00e9 par <code>getDescription()</code>. Soyez explicite sur les b\u00e9n\u00e9fices de l'outil.</p> <ul> <li>Format de retour : La m\u00e9thode <code>execute</code> peut retourner n'importe quel type <code>mixed</code> (array, string, int). Synapse s'occupe de le s\u00e9rialiser proprement en JSON pour le renvoyer au mod\u00e8le.</li> <li>Gestion des erreurs : Si votre outil \u00e9choue, retournez un message d'erreur clair sous forme de cha\u00eene. L'IA pourra ainsi expliquer le probl\u00e8me \u00e0 l'utilisateur ou tenter de corriger ses param\u00e8tres.</li> <li>S\u00e9curit\u00e9 : N'oubliez pas que les param\u00e8tres re\u00e7us dans <code>execute</code> proviennent d'une IA et peuvent \u00eatre erron\u00e9s ou malveillants. Validez-les comme n'importe quelle entr\u00e9e utilisateur.</li> </ul>"},{"location":"reference/contracts/config-provider-interface/","title":"ConfigProviderInterface","text":"<p>L'interface <code>ConfigProviderInterface</code> permet d'ajuster dynamiquement les param\u00e8tres techniques de l'IA (temp\u00e9rature, filtres de s\u00e9curit\u00e9) en fonction du contexte de votre application.</p>"},{"location":"reference/contracts/config-provider-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Adaptabilit\u00e9 : Utiliser une temp\u00e9rature basse (pr\u00e9cision) pour l'analyse de donn\u00e9es et une temp\u00e9rature haute (cr\u00e9ativit\u00e9) pour la r\u00e9daction de mails.</li> <li>S\u00e9curit\u00e9 \u00e0 g\u00e9om\u00e9trie variable : Activer des filtres de s\u00e9curit\u00e9 plus stricts selon le profil de l'utilisateur ou le salon de discussion.</li> <li>A/B Testing : Comparer diff\u00e9rents r\u00e9glages de mod\u00e8les sans modifier le code source.</li> </ul>"},{"location":"reference/contracts/config-provider-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode R\u00f4le <code>getConfig()</code> Retourne un tableau de param\u00e8tres techniques (ex: <code>temperature</code>, <code>top_p</code>)."},{"location":"reference/contracts/config-provider-interface/#exemple-configuration-basee-sur-le-role-utilisateur","title":"\ud83d\ude80 Exemple : Configuration bas\u00e9e sur le r\u00f4le utilisateur","text":"RoleConfigProvider.php <pre><code>namespace App\\Synapse\\Config;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\ConfigProviderInterface;\nuse Symfony\\Bundle\\SecurityBundle\\Security;\n\nclass RoleConfigProvider implements ConfigProviderInterface\n{\n    public function __construct(private Security $security) {}\n\n    public function getConfig(): array\n    {\n        if ($this-&gt;security-&gt;isGranted('ROLE_CREATIVE')) {\n            return ['temperature' =&gt; 1.2];\n        }\n\n        return ['temperature' =&gt; 0.2, 'top_p' =&gt; 0.1];\n    }\n}\n</code></pre>"},{"location":"reference/contracts/config-provider-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<ul> <li>Fusion des options : SynapseBundle fusionne intelligemment la configuration par d\u00e9faut avec celle retourn\u00e9e par votre provider. Vous ne devez renvoyer que les cl\u00e9s que vous souhaitez surcharger.</li> <li>Limites : Attention \u00e0 ne pas renvoyer de valeurs hors limites (ex: temp\u00e9rature &gt; 2.0 pour certains mod\u00e8les), car cela pourrait provoquer des erreurs de l'API LLM.</li> </ul>"},{"location":"reference/contracts/context-provider-interface/","title":"ContextProviderInterface","text":"<p>L'interface <code>ContextProviderInterface</code> est l'un des outils les plus puissants de SynapseBundle. Elle permet d'injecter dynamiquement des instructions syst\u00e8me et des donn\u00e9es m\u00e9tiers au tout d\u00e9but de chaque \u00e9change avec l'IA.</p>"},{"location":"reference/contracts/context-provider-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Prompt Engineering Dynamique : Injecter le nom de l'utilisateur, ses pr\u00e9f\u00e9rences ou son historique d'achats dans le prompt syst\u00e8me.</li> <li>Multilinguisme : Adapter la langue des instructions syst\u00e8me selon la session de l'utilisateur.</li> <li>Isolation des donn\u00e9es : Donner \u00e0 l'IA uniquement les informations dont elle a besoin pour le cas d'usage actuel.</li> </ul>"},{"location":"reference/contracts/context-provider-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>getInstructions()</code> - <code>string</code> Retourne le texte qui sera ajout\u00e9 au prompt syst\u00e8me. <code>getContextData()</code> - <code>array</code> Retourne des donn\u00e9es structur\u00e9es (JSON) que l'IA peut exploiter."},{"location":"reference/contracts/context-provider-interface/#exemple-injecter-le-profil-utilisateur","title":"\ud83d\ude80 Exemple : Injecter le profil utilisateur","text":"UserContextProvider.php <pre><code>namespace App\\Synapse\\Context;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\ContextProviderInterface;\nuse Symfony\\Bundle\\SecurityBundle\\Security;\n\nclass UserContextProvider implements ContextProviderInterface\n{\n    public function __construct(private Security $security) {}\n\n    public function getInstructions(): string\n    {\n        $user = $this-&gt;security-&gt;getUser();\n        return sprintf(\"Tu discutes avec %s. Parle-lui de mani\u00e8re amicale.\", $user-&gt;getUserIdentifier());\n    }\n\n    public function getContextData(): array\n    {\n        return [\n            'language' =&gt; 'fr',\n            'current_time' =&gt; date('Y-m-d H:i:s')\n        ];\n    }\n}\n</code></pre>"},{"location":"reference/contracts/context-provider-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!TIP] Cha\u00eenage : SynapseBundle permet de configurer plusieurs providers. Les instructions de chacun seront concat\u00e9n\u00e9es automatiquement pour former le prompt final.</p> <ul> <li>Fra\u00eecheur des donn\u00e9es : Puisque cette m\u00e9thode est appel\u00e9e au moment de la g\u00e9n\u00e9ration, les donn\u00e9es inject\u00e9es sont toujours \u00e0 jour avec l'\u00e9tat actuel de votre application.</li> </ul>"},{"location":"reference/contracts/conversation-owner-interface/","title":"ConversationOwnerInterface","text":"<p>L'interface <code>ConversationOwnerInterface</code> est le pont entre votre syst\u00e8me d'utilisateurs et SynapseBundle. Elle permet d'identifier \u00e0 qui appartient une discussion pour g\u00e9rer la s\u00e9curit\u00e9 et l'isolation des donn\u00e9es.</p>"},{"location":"reference/contracts/conversation-owner-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Multi-utilisateur : S\u00e9parez herm\u00e9tiquement les chats de l'utilisateur A de ceux de l'utilisateur B.</li> <li>RGPD &amp; Conformit\u00e9 : Liez les donn\u00e9es de l'IA \u00e0 une identit\u00e9 r\u00e9elle pour les demandes de suppression ou d'acc\u00e8s.</li> <li>Flexibilit\u00e9 : Le propri\u00e9taire peut \u00eatre un utilisateur (<code>User</code>), mais aussi une <code>Organisation</code>, une <code>Equipe</code> ou n'importe quelle entit\u00e9 de votre projet.</li> </ul>"},{"location":"reference/contracts/conversation-owner-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode R\u00f4le <code>getId()</code> Identifiant unique (string ou int) pour le stockage. <code>getDisplayName()</code> Nom utilis\u00e9 pour l'affichage (logs, administration). <code>getAvatarUrl()</code> (Optionnel) URL de l'image de profil pour l'UI de chat."},{"location":"reference/contracts/conversation-owner-interface/#exemple-integration-avec-userbundle-security","title":"\ud83d\ude80 Exemple : Int\u00e9gration avec UserBundle / Security","text":"User.php <pre><code>namespace App\\Entity;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\ConversationOwnerInterface;\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\nclass User implements ConversationOwnerInterface\n{\n    #[ORM\\Id, ORM\\GeneratedValue, ORM\\Column]\n    private ?int $id = null;\n\n    #[ORM\\Column]\n    private string $email;\n\n    public function getId(): ?int { return $this-&gt;id; }\n\n    public function getDisplayName(): string { return $this-&gt;email; }\n\n    public function getAvatarUrl(): ?string { return null; }\n}\n</code></pre>"},{"location":"reference/contracts/conversation-owner-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<ul> <li>Identifiant stable : La valeur retourn\u00e9e par <code>getId()</code> est stock\u00e9e en base de donn\u00e9es dans la table des conversations. Assurez-vous qu'elle ne change pas.</li> <li>Acc\u00e8s rapide : Dans vos contr\u00f4leurs, vous pouvez r\u00e9cup\u00e9rer les conversations via le <code>ConversationManager</code> en lui passant simplement <code>$this-&gt;getUser()</code>.</li> </ul>"},{"location":"reference/contracts/embedding-client-interface/","title":"EmbeddingClientInterface","text":"<p>L'interface <code>EmbeddingClientInterface</code> est responsable de la conversion du langage humain en vecteurs math\u00e9matiques (Embeddings). C'est le traducteur n\u00e9cessaire pour que le <code>VectorStore</code> puisse \"comprendre\" le sens des mots.</p>"},{"location":"reference/contracts/embedding-client-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Standardisation : Utiliser un format de vecteur unique pour tout votre projet.</li> <li>Abstraction : Passer d'OpenAI \u00e0 HuggingFace sans modifier votre pipeline de RAG.</li> <li>Efficacit\u00e9 : G\u00e9rer les appels par lots (batching) pour transformer de gros volumes de texte rapidement.</li> </ul>"},{"location":"reference/contracts/embedding-client-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>embedText(string $text)</code> Texte brut <code>array&lt;float&gt;</code> Transforme une phrase en vecteur unique. <code>embedBatch(array $texts)</code> Liste de textes <code>array&lt;array&gt;</code> Optimise le traitement de plusieurs documents. <code>getDimensions()</code> - <code>int</code> Retourne la taille des vecteurs (ex: 1536)."},{"location":"reference/contracts/embedding-client-interface/#exemple-client-dembedding-simule","title":"\ud83d\ude80 Exemple : Client d'embedding simul\u00e9","text":"DebugEmbeddingClient.php <pre><code>namespace App\\Synapse\\Embedding;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\EmbeddingClientInterface;\n\nclass DebugEmbeddingClient implements EmbeddingClientInterface\n{\n    public function embedText(string $text): array\n    {\n        // Simule un vecteur de dimension 3\n        return [0.12, 0.45, 0.89];\n    }\n\n    public function embedBatch(array $texts): array\n    {\n        return array_map([$this, 'embedText'], $texts);\n    }\n\n    public function getDimensions(): int { return 3; }\n}\n</code></pre>"},{"location":"reference/contracts/embedding-client-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<ul> <li>Normalisation : La plupart des mod\u00e8les (comme <code>text-embedding-3-small</code> d'OpenAI) retournent des vecteurs d\u00e9j\u00e0 normalis\u00e9s. Si vous utilisez un mod\u00e8le local, v\u00e9rifiez si vous devez appliquer une normalisation L2.</li> <li>Limites de tokens : Attention \u00e0 la longueur du texte envoy\u00e9 \u00e0 <code>embedText</code>. Si le texte est trop long, il peut \u00eatre n\u00e9cessaire de le d\u00e9couper (Chunking) avant l'appel.</li> </ul>"},{"location":"reference/contracts/encryption-service-interface/","title":"EncryptionServiceInterface","text":"<p>L'interface <code>EncryptionServiceInterface</code> est la sentinelle de la vie priv\u00e9e dans SynapseBundle. Elle permet de chiffrer automatiquement les conversations et les donn\u00e9es sensibles en base de donn\u00e9es.</p>"},{"location":"reference/contracts/encryption-service-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>S\u00e9curit\u00e9 maximale : M\u00eame en cas de fuite de la base de donn\u00e9es, les messages des utilisateurs restent illisibles.</li> <li>Confiance : Offrir des garanties de confidentialit\u00e9 \u00e0 vos clients.</li> <li>RGPD : Facilite la mise en conformit\u00e9 en prot\u00e9geant les donn\u00e9es \u00e0 caract\u00e8re personnel (PII).</li> </ul>"},{"location":"reference/contracts/encryption-service-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>encrypt(string $data)</code> Texte brut <code>string</code> Transforme le message en suite de caract\u00e8res chiffr\u00e9e. <code>decrypt(string $data)</code> Texte chiffr\u00e9 <code>string</code> Restaure le message original pour l'affichage ou le LLM. <code>isEncrypted(string $data)</code> Texte <code>bool</code> D\u00e9tecte si une donn\u00e9e est d\u00e9j\u00e0 chiffr\u00e9e (pr\u00e9vention)."},{"location":"reference/contracts/encryption-service-interface/#exemple-implementation-basee-sur-libsodium","title":"\ud83d\ude80 Exemple : Impl\u00e9mentation bas\u00e9e sur Libsodium","text":"SodiumEncryption.php <pre><code>namespace App\\Synapse\\Security;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\EncryptionServiceInterface;\n\nclass SodiumEncryption implements EncryptionServiceInterface\n{\n    public function __construct(private string $key) {}\n\n    public function encrypt(string $data): string\n    {\n        $nonce = random_bytes(SODIUM_CRYPTO_SECRETBOX_NONCEBYTES);\n        $cipher = sodium_crypto_secretbox($data, $nonce, $this-&gt;key);\n        return base64_encode($nonce . $cipher);\n    }\n\n    public function decrypt(string $data): string\n    {\n        $decoded = base64_decode($data);\n        $nonce = substr($decoded, 0, SODIUM_CRYPTO_SECRETBOX_NONCEBYTES);\n        $cipher = substr($decoded, SODIUM_CRYPTO_SECRETBOX_NONCEBYTES);\n        return sodium_crypto_secretbox_open($cipher, $nonce, $this-&gt;key);\n    }\n\n    public function isEncrypted(string $data): bool\n    {\n        return str_ends_with($data, '=='); // D\u00e9tection simpliste\n    }\n}\n</code></pre>"},{"location":"reference/contracts/encryption-service-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!CAUTION] Gestion des cl\u00e9s : Ne stockez JAMAIS votre cl\u00e9 de chiffrement dans le code source. Utilisez des variables d'environnement (<code>.env.local</code>) ou un coffre-fort de secrets (Vault).</p> <ul> <li>Transparence : SynapseBundle appelle automatiquement ces m\u00e9thodes via le <code>ConversationManager</code>. Vous n'avez pas \u00e0 g\u00e9rer le chiffrement manuellement dans vos contr\u00f4leurs.</li> </ul>"},{"location":"reference/contracts/llm-client-interface/","title":"LlmClientInterface","text":"<p>L'interface <code>LlmClientInterface</code> est le connecteur universel de SynapseBundle. C'est elle qui permet de dialoguer avec les diff\u00e9rents fournisseurs d'IA (OpenAI, Gemini, Mistral, Ollama, etc.) en utilisant un langage commun.</p>"},{"location":"reference/contracts/llm-client-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Ind\u00e9pendance du fournisseur : Changez de moteur d'IA en changeant une seule ligne de configuration sans toucher \u00e0 votre code m\u00e9tier.</li> <li>Support du Streaming : Permet de recevoir des r\u00e9ponses en temps r\u00e9el \"mot par mot\".</li> <li>Standardisation : Transforme les r\u00e9ponses disparates des API en objets <code>SynapseMessage</code> coh\u00e9rents.</li> </ul>"},{"location":"reference/contracts/llm-client-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>supports(string $provider)</code> Nom du provider <code>bool</code> D\u00e9termine si ce client peut g\u00e9rer la demande. <code>generateResponse(...)</code> Messages + Options <code>SynapseMessage</code> Appel synchrone classique. <code>generateStream(...)</code> Messages + Options <code>iterable</code> Appel asynchrone pour streaming. <code>getCredentialFields()</code> - <code>array</code> Liste les cl\u00e9s API n\u00e9cessaires (ex: <code>api_key</code>)."},{"location":"reference/contracts/llm-client-interface/#exemple-un-client-factice-pour-vos-tests","title":"\ud83d\ude80 Exemple : Un client factice pour vos tests","text":"FakeLlmClient.php <pre><code>namespace App\\Synapse\\Client;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\LlmClientInterface;\nuse ArnaudMoncondhuy\\SynapseBundle\\Storage\\Entity\\SynapseMessage;\nuse ArnaudMoncondhuy\\SynapseBundle\\Shared\\Enum\\MessageRole;\n\nclass FakeLlmClient implements LlmClientInterface\n{\n    public function supports(string $provider): bool\n    {\n        return $provider === 'fake';\n    }\n\n    public function generateResponse(array $messages, array $options = []): SynapseMessage\n    {\n        $response = new SynapseMessage();\n        $response-&gt;setRole(MessageRole::MODEL);\n        $response-&gt;setContent(\"Ceci est une r\u00e9ponse simul\u00e9e.\");\n\n        return $response;\n    }\n\n    public function generateStream(array $messages, array $options = []): iterable\n    {\n        yield \"Ceci \";\n        yield \"est \";\n        yield \"un \";\n        yield \"flux.\";\n    }\n\n    public function getCredentialFields(): array\n    {\n        return ['api_key'];\n    }\n}\n</code></pre>"},{"location":"reference/contracts/llm-client-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!IMPORTANT] Format OpenAI Canonical : L'argument <code>$messages</code> re\u00e7u par ces m\u00e9thodes est au format canonique OpenAI (<code>role</code> et <code>content</code>). Cela garantit une compatibilit\u00e9 maximale.</p> <ul> <li>Options LLM : Le tableau <code>$options</code> contient les param\u00e8tres techniques tels que <code>temperature</code>, <code>max_output_tokens</code> et les outils (<code>tools</code>). Veillez \u00e0 les traduire fid\u00e8lement pour votre API cible.</li> <li>Credential Fields : Les champs retourn\u00e9s par <code>getCredentialFields</code> appara\u00eetront automatiquement dans l'interface d'administration de SynapseBundle.</li> </ul>"},{"location":"reference/contracts/message-formatter-interface/","title":"MessageFormatterInterface","text":"<p>L'interface <code>MessageFormatterInterface</code> g\u00e8re la traduction entre vos entit\u00e9s Doctrine (<code>SynapseMessage</code>) et le format d'\u00e9change utilis\u00e9 par les API LLM.</p>"},{"location":"reference/contracts/message-formatter-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Personnalisation du format : Si vous utilisez une API IA qui attend un format de message tr\u00e8s sp\u00e9cifique (autre que le standard OpenAI).</li> <li>Nettoyage des donn\u00e9es : Filtrer ou modifier le contenu des messages avant qu'ils ne sortent de votre serveur.</li> <li>Enrichissement : Ajouter des flags ou des m\u00e9tadonn\u00e9es suppl\u00e9mentaires pour le traitement par le LLM.</li> </ul>"},{"location":"reference/contracts/message-formatter-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>formatAsArray(...)</code> <code>SynapseMessage</code> <code>array</code> Convertit une entit\u00e9 en tableau simple. <code>formatCollection(...)</code> Liste d'entit\u00e9s <code>array</code> Convertit tout l'historique de chat."},{"location":"reference/contracts/message-formatter-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<ul> <li>Format par d\u00e9faut : SynapseBundle inclut d\u00e9j\u00e0 un formateur conforme au standard OpenAI. N'impl\u00e9mentez cette interface que si vous avez des besoins de transformation de donn\u00e9es tr\u00e8s sp\u00e9cifiques.</li> <li>Performance : Cette interface n'est g\u00e9n\u00e9ralement pas le lieu pour des calculs lourds, car elle est appel\u00e9e juste avant chaque requ\u00eate API.</li> </ul>"},{"location":"reference/contracts/overview/","title":"Vue d'ensemble des Contrats (Interfaces)","text":"<p>SynapseBundle est con\u00e7u comme un kit de construction. Chaque brique majeure est d\u00e9finie par une interface (un \"contrat\") que vous pouvez r\u00e9impl\u00e9menter pour adapter le bundle \u00e0 vos besoins exacts.</p>"},{"location":"reference/contracts/overview/#les-piliers-du-systeme","title":"\ud83c\udfd7 Les piliers du syst\u00e8me","text":"<p>Cliquez sur une interface pour d\u00e9couvrir son guide d'impl\u00e9mentation premium.</p>"},{"location":"reference/contracts/overview/#cur-orchestration","title":"\ud83e\udde0 C\u0153ur &amp; Orchestration","text":"Interface R\u00f4le principal LlmClientInterface Le Moteur. Connecte Synapse \u00e0 OpenAI, Gemini, Ollama, etc. AiToolInterface L'Action. Permet \u00e0 l'IA d'appeler votre code PHP (Function Calling). AgentInterface Le Cerveau. D\u00e9finit une personnalit\u00e9 et des outils sp\u00e9cifiques."},{"location":"reference/contracts/overview/#rag-memoire-memoire-long-terme","title":"\ud83d\udcbe RAG &amp; M\u00e9moire (M\u00e9moire long-terme)","text":"Interface R\u00f4le principal VectorStoreInterface Le Stockage. G\u00e8re les documents vectoris\u00e9s (PostgreSQL, Pinecone). EmbeddingClientInterface Le Traducteur. Transforme le texte en vecteurs math\u00e9matiques."},{"location":"reference/contracts/overview/#securite-conformite","title":"\ud83d\udee1 S\u00e9curit\u00e9 &amp; Conformit\u00e9","text":"Interface R\u00f4le principal EncryptionService La Vie Priv\u00e9e. Chiffre vos messages en base de donn\u00e9es. PermissionChecker Le Gardien. Contr\u00f4le qui peut lire ou modifier quel chat. RetentionPolicy Le RGPD. D\u00e9finit les r\u00e8gles de purge automatique."},{"location":"reference/contracts/overview/#personnalisation-du-flux","title":"\u2699\ufe0f Personnalisation du Flux","text":"Interface R\u00f4le principal ContextProvider L'Injection. Ajoute des donn\u00e9es dynamiques au prompt syst\u00e8me. ConfigProvider Le R\u00e9glage. Ajuste la temp\u00e9rature et les filtres dynamiquement. <p>[!TIP] Pas besoin de tout impl\u00e9menter ! SynapseBundle arrive avec des impl\u00e9mentations par d\u00e9faut pour la plupart de ces briques. Vous ne remplacez que ce dont vous avez r\u00e9ellement besoin.</p>"},{"location":"reference/contracts/permission-checker-interface/","title":"PermissionCheckerInterface","text":"<p>L'interface <code>PermissionCheckerInterface</code> permet de d\u00e9l\u00e9guer la logique de s\u00e9curit\u00e9 de SynapseBundle \u00e0 votre syst\u00e8me de droits existant (Voters Symfony, ACL, etc.).</p>"},{"location":"reference/contracts/permission-checker-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Int\u00e9gration native : Utilisez vos r\u00f4les (<code>ROLE_ADMIN</code>, <code>ROLE_USER</code>) pour contr\u00f4ler l'acc\u00e8s aux fils de discussion.</li> <li>Isolation : Garantir qu'un utilisateur ne puisse ni voir ni modifier les conversations des autres.</li> <li>Multi-niveaux : Distinguer le droit de lecture, d'\u00e9dition et de suppression.</li> </ul>"},{"location":"reference/contracts/permission-checker-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Cible R\u00f4le <code>canView($conversation)</code> Conversation Autorise ou non la lecture. <code>canEdit($conversation)</code> Conversation Autorise ou non l'envoi de messages. <code>canDelete($conversation)</code> Conversation Autorise ou non la suppression/archivage."},{"location":"reference/contracts/permission-checker-interface/#exemple-implementation-via-symfony-security","title":"\ud83d\ude80 Exemple : Impl\u00e9mentation via Symfony Security","text":"SynapseVoterChecker.php <pre><code>namespace App\\Synapse\\Security;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\PermissionCheckerInterface;\nuse Symfony\\Bundle\\SecurityBundle\\Security;\n\nclass SynapseVoterChecker implements PermissionCheckerInterface\n{\n    public function __construct(private Security $security) {}\n\n    public function canView($conversation): bool\n    {\n        return $this-&gt;security-&gt;isGranted('VIEW', $conversation);\n    }\n\n    public function canEdit($conversation): bool\n    {\n        return $this-&gt;security-&gt;isGranted('EDIT', $conversation);\n    }\n\n    public function canDelete($conversation): bool\n    {\n        // Seuls les admins peuvent supprimer\n        return $this-&gt;security-&gt;isGranted('ROLE_ADMIN');\n    }\n}\n</code></pre>"},{"location":"reference/contracts/permission-checker-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<ul> <li>D\u00e9l\u00e9gation : Si vous ne souhaitez pas g\u00e9rer de permissions complexes, vous pouvez laisser cette interface non impl\u00e9ment\u00e9e (Synapse autorisera alors tout par d\u00e9faut au sein du manager, mais il est fortement recommand\u00e9 de la configurer).</li> <li>Performance : Ces m\u00e9thodes sont appel\u00e9es \u00e0 chaque acc\u00e8s aux messages. Veillez \u00e0 ce qu'elles ne fassent pas de requ\u00eates SQL lourdes.</li> </ul>"},{"location":"reference/contracts/retention-policy-interface/","title":"RetentionPolicyInterface","text":"<p>L'interface <code>RetentionPolicyInterface</code> r\u00e9pond aux exigences de conservation des donn\u00e9es. Elle permet d'automatiser le nettoyage des anciennes conversations pour respecter vos engagements de confidentialit\u00e9 ou le RGPD.</p>"},{"location":"reference/contracts/retention-policy-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Droit \u00e0 l'oubli : Supprimer automatiquement les messages apr\u00e8s X jours.</li> <li>Hygi\u00e8ne des donn\u00e9es : \u00c9viter l'accumulation inutile de donn\u00e9es lourdes en base.</li> <li>Conformit\u00e9 : Appliquer des r\u00e8gles diff\u00e9rentes selon les types d'utilisateurs ou les pays.</li> </ul>"},{"location":"reference/contracts/retention-policy-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode R\u00f4le <code>shouldDeleteConversation(...)</code> D\u00e9cide si une conversation doit \u00eatre purg\u00e9e maintenant. <code>getMaxRetentionDays()</code> Temps de conservation par d\u00e9faut pour les rapports."},{"location":"reference/contracts/retention-policy-interface/#exemple-politique-de-30-jours","title":"\ud83d\ude80 Exemple : Politique de 30 jours","text":"StandardRetentionPolicy.php <pre><code>namespace App\\Synapse\\Security;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\RetentionPolicyInterface;\n\nclass StandardRetentionPolicy implements RetentionPolicyInterface\n{\n    public function shouldDeleteConversation($conversation): bool\n    {\n        $updatedAt = $conversation-&gt;getUpdatedAt();\n        $diff = $updatedAt-&gt;diff(new \\DateTime());\n\n        return $diff-&gt;days &gt; 30;\n    }\n\n    public function getMaxRetentionDays(): int { return 30; }\n}\n</code></pre>"},{"location":"reference/contracts/retention-policy-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!TIP] Action Diff\u00e9r\u00e9e : SynapseBundle fournit une commande console <code>synapse:purge</code> qui utilise cette interface. Vous pouvez planifier cette commande via un CRON pour un nettoyage quotidien.</p> <ul> <li>Ciblage : Vous pouvez affiner la logique pour, par exemple, ne jamais supprimer les conversations des comptes \"VIP\".</li> </ul>"},{"location":"reference/contracts/synapse-debug-logger-interface/","title":"SynapseDebugLoggerInterface","text":"<p>L'interface <code>SynapseDebugLoggerInterface</code> permet d'exporter et de journaliser l'int\u00e9gralit\u00e9 des \u00e9changes techniques entre SynapseBundle et les LLM.</p>"},{"location":"reference/contracts/synapse-debug-logger-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Observabilit\u00e9 : Voir exactement ce qui a \u00e9t\u00e9 envoy\u00e9 et re\u00e7u par l'IA dans vos outils de log (ELK, CloudWatch, etc.).</li> <li>Aide au d\u00e9veloppement : Diagnostiquer pourquoi un outil n'a pas \u00e9t\u00e9 appel\u00e9 ou pourquoi le LLM a mal interpr\u00e9t\u00e9 un prompt.</li> <li>Audit : Conserver une trace technique des interactions IA pour des besoins de conformit\u00e9.</li> </ul>"},{"location":"reference/contracts/synapse-debug-logger-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode R\u00f4le <code>logExchange(...)</code> Enregistre l'int\u00e9gralit\u00e9 d'un \u00e9change (Requ\u00eate + R\u00e9ponse + Usage)."},{"location":"reference/contracts/synapse-debug-logger-interface/#exemple-enregistrement-dans-les-logs-symfony","title":"\ud83d\ude80 Exemple : Enregistrement dans les logs Symfony","text":"SymfonyDebugLogger.php <pre><code>namespace App\\Synapse\\Log;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\SynapseDebugLoggerInterface;\nuse Psr\\Log\\LoggerInterface;\n\nclass SymfonyDebugLogger implements SynapseDebugLoggerInterface\n{\n    public function __construct(private LoggerInterface $logger) {}\n\n    public function logExchange(string $debugId, array $data): void\n    {\n        $this-&gt;logger-&gt;debug(sprintf(\"Synapse Exchange %s\", $debugId), $data);\n    }\n}\n</code></pre>"},{"location":"reference/contracts/synapse-debug-logger-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<ul> <li>Activation : Le logging de debug n'est d\u00e9clench\u00e9 que si l'option <code>debug: true</code> est pass\u00e9e lors de l'appel \u00e0 <code>ChatService::ask()</code>.</li> <li>Charge de donn\u00e9es : Le tableau <code>$data</code> peut \u00eatre volumineux (plusieurs Mo si la conversation est longue). Veillez \u00e0 ce que votre syst\u00e8me de log puisse supporter ce volume ou filtrez les donn\u00e9es inutiles.</li> </ul>"},{"location":"reference/contracts/vector-store-interface/","title":"VectorStoreInterface","text":"<p>L'interface <code>VectorStoreInterface</code> est le socle du syst\u00e8me de RAG (Retrieval-Augmented Generation) dans SynapseBundle. Elle d\u00e9finit comment stocker et rechercher des informations \"vectoris\u00e9es\" (embeddings) pour donner une m\u00e9moire long-terme \u00e0 votre IA.</p>"},{"location":"reference/contracts/vector-store-interface/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>M\u00e9moire illimit\u00e9e : Permet \u00e0 l'IA d'acc\u00e9der \u00e0 des milliers de documents sans saturer la fen\u00eatre de contexte.</li> <li>Recherche s\u00e9mantique : Trouve des informations bas\u00e9es sur le sens plut\u00f4t que sur des simples mots-cl\u00e9s.</li> <li>Performances : D\u00e9l\u00e8gue la recherche complexe \u00e0 des moteurs sp\u00e9cialis\u00e9s (Pinecone, Weaviate, PostgreSQL avec pgvector).</li> </ul>"},{"location":"reference/contracts/vector-store-interface/#resume-du-contrat","title":"\ud83d\udccb R\u00e9sum\u00e9 du Contrat","text":"M\u00e9thode Entr\u00e9e Sortie R\u00f4le <code>add(array $vectors)</code> Liste d'objets <code>Embedding</code> <code>void</code> Ins\u00e8re de nouvelles donn\u00e9es dans la base vectorielle. <code>search(array $vector, int $limit)</code> Vecteur de recherche <code>array</code> R\u00e9cup\u00e8re les documents les plus proches s\u00e9mantiquement. <code>delete(array $ids)</code> Liste d'identifiants <code>void</code> Supprime des entr\u00e9es sp\u00e9cifiques. <code>clear()</code> - <code>void</code> R\u00e9initialise compl\u00e8tement le store."},{"location":"reference/contracts/vector-store-interface/#exemple-implementation-simplifiee-en-memoire","title":"\ud83d\ude80 Exemple : Impl\u00e9mentation simplifi\u00e9e en m\u00e9moire","text":"InMemoryVectorStore.php <pre><code>namespace App\\Synapse\\Vector;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Contract\\VectorStoreInterface;\n\nclass InMemoryVectorStore implements VectorStoreInterface\n{\n    private array $storage = [];\n\n    public function add(array $vectors): void\n    {\n        foreach ($vectors as $v) {\n            // $v['id'], $v['vector'], $v['metadata']\n            $this-&gt;storage[$v['id']] = $v;\n        }\n    }\n\n    public function search(array $vector, int $limit = 5): array\n    {\n        // Ici, vous impl\u00e9menteriez un calcul de similarit\u00e9 cosinus.\n        // Pour l'exemple, on retourne les 5 premiers \u00e9l\u00e9ments.\n        return array_slice($this-&gt;storage, 0, $limit);\n    }\n\n    public function delete(array $ids): void\n    {\n        foreach ($ids as $id) unset($this-&gt;storage[$id]);\n    }\n\n    public function clear(): void { $this-&gt;storage = []; }\n}\n</code></pre>"},{"location":"reference/contracts/vector-store-interface/#conseils-dimplementation","title":"\ud83d\udca1 Conseils d'impl\u00e9mentation","text":"<p>[!TIP] M\u00e9tadonn\u00e9es : La m\u00e9thode <code>add</code> re\u00e7oit un champ <code>metadata</code>. Utilisez-le pour stocker le texte source ou l'URL du document original. Cela facilitera l'affichage des sources par l'IA.</p> <ul> <li>Identifiants : G\u00e9rez soigneusement les IDs pour \u00e9viter les doublons lors de la mise \u00e0 jour de vos documents.</li> <li>Dimensionalit\u00e9 : Assurez-vous que votre Store accepte la m\u00eame dimension de vecteur que celle g\u00e9n\u00e9r\u00e9e par votre <code>EmbeddingClientInterface</code> (ex: 1536 pour OpenAI).</li> </ul>"},{"location":"reference/events/chunk-received-event/","title":"SynapseChunkReceivedEvent","text":"<p>L'\u00e9v\u00e9nement <code>SynapseChunkReceivedEvent</code> est la cl\u00e9 pour cr\u00e9er des interfaces r\u00e9actives. Il est d\u00e9clench\u00e9 \u00e0 chaque fois qu'un nouveau morceau de texte (token) est re\u00e7u du fournisseur d'IA en mode streaming.</p>"},{"location":"reference/events/chunk-received-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Exp\u00e9rience \"ChatGPT\" : Afficher la r\u00e9ponse en temps r\u00e9el plut\u00f4t que d'attendre 20 secondes une r\u00e9ponse compl\u00e8te.</li> <li>Consommation progressive : Traiter ou analyser le d\u00e9but de la r\u00e9ponse pendant que la fin est encore en cours de g\u00e9n\u00e9ration.</li> <li>Monitoring : Suivre la vitesse de g\u00e9n\u00e9ration (tokens par seconde).</li> </ul>"},{"location":"reference/events/chunk-received-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getChunk()</code> Retourne le fragment de texte venant d'arriver (ex: \"Bonjour\"). <code>getDebugId()</code> Permet de relier ce morceau \u00e0 une session sp\u00e9cifique."},{"location":"reference/events/chunk-received-event/#exemple-diffusion-vers-mercure-ou-websockets","title":"\ud83d\ude80 Exemple : Diffusion vers Mercure ou WebSockets","text":"StreamingSubscriber.php <pre><code>namespace App\\EventSubscriber;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Core\\Event\\SynapseChunkReceivedEvent;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\nclass StreamingSubscriber implements EventSubscriberInterface\n{\n    public function onChunk(SynapseChunkReceivedEvent $event): void\n    {\n        $text = $event-&gt;getChunk();\n        // Envoyer le fragment au navigateur via WebSockets ou Server-Sent Events\n        $this-&gt;webSocketSender-&gt;send('chat_topic', ['content' =&gt; $text]);\n    }\n\n    public static function getSubscribedEvents(): array\n    {\n        return [SynapseChunkReceivedEvent::class =&gt; 'onChunk'];\n    }\n}\n</code></pre>"},{"location":"reference/events/chunk-received-event/#conseils-dusage","title":"\ud83d\udca1 Conseils d'usage","text":"<p>[!TIP] Activation : Pour que cet \u00e9v\u00e9nement soit d\u00e9clench\u00e9, vous devez imp\u00e9rativement passer l'option <code>stream: true</code> lors de votre appel \u00e0 <code>ChatService::ask()</code>.</p>"},{"location":"reference/events/exchange-completed-event/","title":"SynapseExchangeCompletedEvent (Debug)","text":"<p>L'\u00e9v\u00e9nement <code>SynapseExchangeCompletedEvent</code> est l'outil ultime pour le diagnostic technique. Il est d\u00e9clench\u00e9 \u00e0 la toute fin, apr\u00e8s la fin de la g\u00e9n\u00e9ration, et contient les donn\u00e9es brutes des requ\u00eates API.</p>"},{"location":"reference/events/exchange-completed-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Debug profond : Examiner les en-t\u00eates HTTP ou les payloads JSON exacts envoy\u00e9s aux providers.</li> <li>Monitoring de s\u00e9curit\u00e9 : Analyser les scores de s\u00e9curit\u00e9 (<code>safety_ratings</code>) renvoy\u00e9s par des mod\u00e8les comme Gemini.</li> <li>Relecture technique : Sauvegarder l'int\u00e9gralit\u00e9 d'un \u00e9change pour une relecture humaine ult\u00e9rieure.</li> </ul>"},{"location":"reference/events/exchange-completed-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getRawData()</code> Le Graal. Contient les tableaux PHP des requ\u00eates et r\u00e9ponses API. <code>getSafety()</code> Liste les \u00e9valuations de s\u00e9curit\u00e9 du provider. <code>getProvider()</code> Nom du client utilis\u00e9 (ex: <code>gemini</code>). <code>getModel()</code> Identifiant exact du mod\u00e8le utilis\u00e9."},{"location":"reference/events/exchange-completed-event/#exemple-export-vers-un-systeme-danalyse","title":"\ud83d\ude80 Exemple : Export vers un syst\u00e8me d'analyse","text":"DebugSubscriber.php <pre><code>public function onExchangeCompleted(SynapseExchangeCompletedEvent $event): void\n{\n    if ($event-&gt;isDebugMode()) {\n        $this-&gt;externalDebugger-&gt;send($event-&gt;getRawData());\n    }\n}\n</code></pre>"},{"location":"reference/events/generation-completed-event/","title":"SynapseGenerationCompletedEvent","text":"<p>L'\u00e9v\u00e9nement <code>SynapseGenerationCompletedEvent</code> est le signal de fin. Il est \u00e9mis une fois que le LLM a fini de g\u00e9n\u00e9rer sa r\u00e9ponse et que tous les outils ont \u00e9t\u00e9 r\u00e9solus.</p>"},{"location":"reference/events/generation-completed-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Finalisation : Calculer le co\u00fbt total de l'\u00e9change et d\u00e9biter le compte de l'utilisateur.</li> <li>Post-traitement : Analyser le sentiment de la r\u00e9ponse finale ou v\u00e9rifier la pr\u00e9sence de mots interdits.</li> <li>Notifications : Envoyer une notification push si l'utilisateur n'est plus sur la page de chat.</li> </ul>"},{"location":"reference/events/generation-completed-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getFullResponse()</code> Le texte complet et d\u00e9finitif g\u00e9n\u00e9r\u00e9 par l'IA. <code>getUsage()</code> Statistiques de consommation (tokens d'entr\u00e9e et de sortie). <code>getDebugId()</code> ID unique de l'\u00e9change (si mode debug actif)."},{"location":"reference/events/generation-completed-event/#exemple-calcul-de-cout-et-facturation","title":"\ud83d\ude80 Exemple : Calcul de co\u00fbt et facturation","text":"BillingSubscriber.php <pre><code>public function onGenerationCompleted(SynapseGenerationCompletedEvent $event): void\n{\n    $usage = $event-&gt;getUsage();\n    $totalTokens = $usage['prompt_tokens'] + $usage['completion_tokens'];\n\n    $this-&gt;billingService-&gt;recordUsage($totalTokens);\n}\n</code></pre>"},{"location":"reference/events/generation-started-event/","title":"SynapseGenerationStartedEvent","text":"<p>L'\u00e9v\u00e9nement <code>SynapseGenerationStartedEvent</code> marque le point de d\u00e9part de toute interaction. Il est \u00e9mis par le <code>ChatService</code> avant toute analyse ou appel externe.</p>"},{"location":"reference/events/generation-started-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Initialisation : Pr\u00e9parer des services tiers, d\u00e9marrer un chronom\u00e8tre de performance ou initialiser un ID de session.</li> <li>Validation pr\u00e9coce : V\u00e9rifier une derni\u00e8re fois si l'utilisateur a les cr\u00e9dits n\u00e9cessaires ou si le service est disponible.</li> <li>Audit : Enregistrer l'intention de l'utilisateur dans un journal de bord permanent.</li> </ul>"},{"location":"reference/events/generation-started-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getMessage()</code> R\u00e9cup\u00e8re le texte brut envoy\u00e9 par l'utilisateur. <code>getOptions()</code> Liste des options techniques choisies pour cet appel."},{"location":"reference/events/generation-started-event/#exemple-demarrer-un-compteur-de-performance","title":"\ud83d\ude80 Exemple : D\u00e9marrer un compteur de performance","text":"MetricsSubscriber.php <pre><code>public function onGenerationStarted(SynapseGenerationStartedEvent $event): void\n{\n    $this-&gt;metricsCollector-&gt;startTimer('llm_generation_time');\n}\n</code></pre>"},{"location":"reference/events/overview/","title":"Cycle de vie des \u00c9v\u00e9nements","text":"<p>SynapseBundle est enti\u00e8rement \u00e9v\u00e8nementiel. Cela vous permet d'intervenir \u00e0 chaque \u00e9tape de la g\u00e9n\u00e9ration pour modifier le comportement de l'IA.</p>"},{"location":"reference/events/overview/#sequence-dexecution","title":"S\u00e9quence d'ex\u00e9cution","text":"<p>Voici l'ordre d'apparition des \u00e9v\u00e9nements lors d'un appel \u00e0 <code>ChatService::ask()</code> :</p> <ol> <li><code>SynapseGenerationStartedEvent</code> : D\u00e9but global. Initialisation.</li> <li><code>SynapsePrePromptEvent</code> : Crucial. Modification du prompt syst\u00e8me ou du contexte juste avant l'envoi.</li> <li><code>SynapseChunkReceivedEvent</code> : R\u00e9p\u00e9t\u00e9 pour chaque token re\u00e7u (Streaming).</li> <li><code>SynapseToolCallRequestedEvent</code> : Si le LLM demande un outil. D\u00e9clenche l'ex\u00e9cution.</li> <li><code>SynapseToolCallCompletedEvent</code> : Une fois l'outil ex\u00e9cut\u00e9, contient le r\u00e9sultat.</li> <li>Retour \u00e0 l'\u00e9tape 3 si le LLM a besoin de traiter les r\u00e9sultats d'outils.</li> <li><code>SynapseGenerationCompletedEvent</code> : Fin de la g\u00e9n\u00e9ration textuelle.</li> <li><code>SynapseExchangeCompletedEvent</code> : Fin technique de l'\u00e9change (Debug &amp; Logs).</li> </ol>"},{"location":"reference/events/overview/#diagramme-des-flux","title":"Diagramme des flux","text":"<pre><code>sequenceDiagram\n    participant App\n    participant ChatService\n    participant LLM\n\n    App-&gt;&gt;ChatService: ask($message)\n    ChatService-&gt;&gt;App: Event: GenerationStarted\n    ChatService-&gt;&gt;App: Event: PrePrompt\n    ChatService-&gt;&gt;LLM: Requ\u00eate API\n    loop Streaming\n        LLM--&gt;&gt;ChatService: Token / Chunk\n        ChatService-&gt;&gt;App: Event: ChunkReceived\n    end\n    opt Tool Calling\n        ChatService-&gt;&gt;App: Event: ToolCallRequested\n        App--&gt;&gt;ChatService: R\u00e9sultat de l'outil\n        ChatService-&gt;&gt;App: Event: ToolCallCompleted\n        ChatService-&gt;&gt;LLM: Envoi du r\u00e9sultat\n        LLM--&gt;&gt;ChatService: Suite de la r\u00e9ponse...\n    end\n    ChatService-&gt;&gt;App: Event: GenerationCompleted\n    ChatService-&gt;&gt;App: Event: ExchangeCompleted\n</code></pre>"},{"location":"reference/events/pre-prompt-event/","title":"SynapsePrePromptEvent","text":"<p>L'\u00e9v\u00e9nement <code>SynapsePrePromptEvent</code> est l'un des plus importants pour la personnalisation. Il vous permet d'intervenir juste avant que la requ\u00eate ne soit envoy\u00e9e au LLM pour modifier le prompt syst\u00e8me ou le contexte.</p>"},{"location":"reference/events/pre-prompt-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Personnalisation \u00e0 la vol\u00e9e : Ajouter des instructions sp\u00e9cifiques selon l'utilisateur (\"Aujourd'hui, l'utilisateur est de mauvaise humeur, sois plus bref\").</li> <li>Enrichissement dynamique : Injecter des donn\u00e9es fra\u00eeches r\u00e9cup\u00e9r\u00e9es depuis une API tierce.</li> <li>Contr\u00f4le final : S'assurer que certaines r\u00e8gles de s\u00e9curit\u00e9 sont bien pr\u00e9sentes dans le prompt syst\u00e8me final.</li> </ul>"},{"location":"reference/events/pre-prompt-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getSystemPrompt()</code> R\u00e9cup\u00e8re le texte actuel du prompt syst\u00e8me. <code>setSystemPrompt(string)</code> \u00c9crase ou compl\u00e8te les instructions syst\u00e8me. <code>getMessages()</code> Acc\u00e8de \u00e0 l'historique complet des messages. <code>setMessages(array)</code> Permet de filtrer ou modifier l'historique avant l'envoi."},{"location":"reference/events/pre-prompt-event/#exemple-injecter-une-humeur-variable","title":"\ud83d\ude80 Exemple : Injecter une humeur variable","text":"MoodSubscriber.php <pre><code>namespace App\\EventSubscriber;\n\nuse ArnaudMoncondhuy\\SynapseBundle\\Core\\Event\\SynapsePrePromptEvent;\nuse Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n\nclass MoodSubscriber implements EventSubscriberInterface\n{\n    public static function getSubscribedEvents(): array\n    {\n        return [SynapsePrePromptEvent::class =&gt; 'onPrePrompt'];\n    }\n\n    public function onPrePrompt(SynapsePrePromptEvent $event): void\n    {\n        $prompt = $event-&gt;getSystemPrompt();\n        $newPrompt = $prompt . \"\\nIMPORTANT: R\u00e9ponds comme si tu \u00e9tais un pirate.\";\n\n        $event-&gt;setSystemPrompt($newPrompt);\n    }\n}\n</code></pre>"},{"location":"reference/events/pre-prompt-event/#conseils-dusage","title":"\ud83d\udca1 Conseils d'usage","text":"<p>[!WARNING] Attention \u00e0 la longueur : Si vous ajoutez trop d'informations dans le prompt syst\u00e8me via cet \u00e9v\u00e9nement, vous risquez de d\u00e9passer la limite de tokens du mod\u00e8le ou de diluer les instructions initiales.</p>"},{"location":"reference/events/tool-call-completed-event/","title":"SynapseToolCallCompletedEvent","text":"<p>L'\u00e9v\u00e9nement <code>SynapseToolCallCompletedEvent</code> confirme qu'un outil a fini son ex\u00e9cution (qu'elle soit r\u00e9ussie ou non). Il permet de r\u00e9cup\u00e9rer le r\u00e9sultat brut avant qu'il ne soit renvoy\u00e9 au LLM.</p>"},{"location":"reference/events/tool-call-completed-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Audit de pr\u00e9cision : Comparer les arguments envoy\u00e9s par l'IA avec le r\u00e9sultat r\u00e9el obtenu.</li> <li>Logging sp\u00e9cifique : Enregistrer les r\u00e9sultats d'outils sensibles dans une base de donn\u00e9es de tra\u00e7abilit\u00e9.</li> <li>Intervention : Modifier le r\u00e9sultat de l'outil avant qu'il n'atteigne l'IA (enveloppe de s\u00e9curit\u00e9).</li> </ul>"},{"location":"reference/events/tool-call-completed-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getToolName()</code> Identifiant technique de l'outil qui vient de s'ex\u00e9cuter. <code>getResult()</code> La valeur brute retourn\u00e9e par votre code PHP. <code>getToolCallData()</code> Payload complet de l'appel (arguments du LLM)."},{"location":"reference/events/tool-call-completed-event/#exemple-logger-les-resultats-dapi","title":"\ud83d\ude80 Exemple : Logger les r\u00e9sultats d'API","text":"ToolLogSubscriber.php <pre><code>public function onToolCompleted(SynapseToolCallCompletedEvent $event): void\n{\n    $this-&gt;logger-&gt;info(sprintf(\n        \"Outil '%s' ex\u00e9cut\u00e9 avec succ\u00e8s. R\u00e9sultat: %s\",\n        $event-&gt;getToolName(),\n        json_encode($event-&gt;getResult())\n    ));\n}\n</code></pre>"},{"location":"reference/events/tool-call-requested-event/","title":"SynapseToolCallRequestedEvent","text":"<p>L'\u00e9v\u00e9nement <code>SynapseToolCallRequestedEvent</code> est au c\u0153ur du m\u00e9canisme de \"Function Calling\". Il est d\u00e9clench\u00e9 lorsque le LLM d\u00e9cide qu'il a besoin d'utiliser un outil (ex: <code>get_weather</code>) pour r\u00e9pondre \u00e0 l'utilisateur.</p>"},{"location":"reference/events/tool-call-requested-event/#pourquoi-lutiliser","title":"\ud83d\udee0 Pourquoi l'utiliser ?","text":"<ul> <li>Customisation de l'ex\u00e9cution : Si vous ne souhaitez pas utiliser le <code>ToolExecutionSubscriber</code> par d\u00e9faut, vous pouvez capturer cet \u00e9v\u00e9nement pour g\u00e9rer vous-m\u00eame l'appel de vos services.</li> <li>Log des intentions : Enregistrer ce que l'IA s'appr\u00eate \u00e0 faire avant qu'elle ne le fasse.</li> <li>Validation / Approbation : Intercepter l'appel pour demander une validation humaine avant d'ex\u00e9cuter une action sensible (ex: supprimer un compte).</li> </ul>"},{"location":"reference/events/tool-call-requested-event/#methodes-principales","title":"\ud83d\udccb M\u00e9thodes principales","text":"M\u00e9thode R\u00f4le <code>getToolCalls()</code> Liste des outils demand\u00e9s avec leurs IDs et arguments. <code>setToolResult(name, res)</code> Crucial. Enregistre le r\u00e9sultat de votre code PHP pour le renvoyer au LLM. <code>areAllResultsRegistered()</code> V\u00e9rifie si tous les outils demand\u00e9s ont une r\u00e9ponse pr\u00eate."},{"location":"reference/events/tool-call-requested-event/#exemple-simulation-de-resultat-manuel","title":"\ud83d\ude80 Exemple : Simulation de r\u00e9sultat manuel","text":"ManualToolSubscriber.php <pre><code>public function onToolRequest(SynapseToolCallRequestedEvent $event): void\n{\n    foreach ($event-&gt;getToolCalls() as $call) {\n        if ($call['name'] === 'calculator') {\n            $result = $call['args']['a'] + $call['args']['b'];\n            $event-&gt;setToolResult('calculator', $result);\n        }\n    }\n}\n</code></pre>"},{"location":"reference/shared/conversation-status/","title":"ConversationStatus (Enum)","text":"<p>L'\u00e9num\u00e9ration <code>ConversationStatus</code> d\u00e9finit les \u00e9tats possibles d'une conversation dans le cycle de vie de votre application.</p>"},{"location":"reference/shared/conversation-status/#les-etats","title":"\ud83d\udccb Les \u00c9tats","text":"\u00c9tat Signification <code>ACTIVE</code> Discussion en cours et visible. <code>ARCHIVED</code> Discussion masqu\u00e9e par l'utilisateur mais conserv\u00e9e. <code>DELETED</code> Discussion marqu\u00e9e pour suppression (Soft Delete). <code>BLOCKED</code> Discussion suspendue pour raisons de s\u00e9curit\u00e9."},{"location":"reference/shared/conversation-status/#reference-complete","title":"\ud83d\udd0d R\u00e9f\u00e9rence compl\u00e8te","text":""},{"location":"reference/shared/message-role/","title":"MessageRole (Enum)","text":"<p>L'\u00e9num\u00e9ration <code>MessageRole</code> d\u00e9finit l'origine et la fonction de chaque message. C'est le dictionnaire qui permet aux mod\u00e8les d'IA de comprendre la structure de la conversation.</p>"},{"location":"reference/shared/message-role/#les-4-roles-cles","title":"\ud83d\udccb Les 4 R\u00f4les Cl\u00e9s","text":"R\u00f4le Description Usage <code>USER</code> L'humain Vos messages envoy\u00e9s au chatbot. <code>MODEL</code> L'IA Les r\u00e9ponses g\u00e9n\u00e9r\u00e9es par Synapse. <code>SYSTEM</code> Le cadre Instructions invisibles pour l'utilisateur (ex: \"Sois poli\"). <code>FUNCTION</code> La tech R\u00e9sultat de l'ex\u00e9cution d'un outil PHP."},{"location":"reference/shared/message-role/#utilisation-dans-votre-code","title":"\ud83d\ude80 Utilisation dans votre code","text":"RoleUsage.php <pre><code>use ArnaudMoncondhuy\\SynapseBundle\\Shared\\Enum\\MessageRole;\n\n// V\u00e9rifier si un message doit \u00eatre affich\u00e9 dans le chat\nif ($message-&gt;getRole()-&gt;isDisplayable()) {\n    echo $message-&gt;getRole()-&gt;getEmoji() . \" \" . $message-&gt;getContent();\n}\n</code></pre>"},{"location":"reference/shared/message-role/#reference-complete","title":"\ud83d\udd0d R\u00e9f\u00e9rence compl\u00e8te","text":""}]}