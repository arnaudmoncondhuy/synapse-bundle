{# Template fragment : Resultat du test (injecté dans preset_test_waiting) #}
<style>
	.synapse-result-badge {
		padding: 4px 12px;
		border-radius: 6px;
		font-weight: 600;
		font-size: 0.85rem;
	}
	.synapse-result-badge--success {
		background: #dcfce7;
		color: #166534;
	}
	.synapse-result-badge--warning {
		background: #fef3c7;
		color: #92400e;
	}

	.synapse-result-section {
		background: white;
		border-radius: 8px;
		padding: 1.5rem;
		margin-bottom: 2rem;
		border: 1px solid var(--synapse-admin-border-light);
		text-align: left;
	}
	.synapse-result-section h2 {
		font-size: 1.1rem;
		margin-bottom: 1rem;
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}
	.synapse-ai-response {
		background: var(--synapse-admin-bg-main);
		border-left: 4px solid var(--synapse-admin-primary);
		padding: 1rem;
		border-radius: 4px;
		margin: 1rem 0;
		white-space: pre-wrap;
	}
	#analysis-rendered {
		background: var(--synapse-admin-bg-main);
		padding: 1.5rem;
		border-radius: 8px;
		margin-bottom: 1rem;
	}
	#analysis-rendered h3 {
		margin-bottom: 1rem;
		color: var(--synapse-admin-primary);
	}
	#analysis-rendered ul {
		margin-left: 1.5rem;
		margin-bottom: 1rem;
	}

	.usage-table {
		width: 100%;
		border-collapse: collapse;
	}
	.usage-table th,
	.usage-table td {
		padding: 0.75rem;
		border-bottom: 1px solid var(--synapse-admin-border-light);
		text-align: left;
	}
	.usage-table th {
		background: var(--synapse-admin-bg-main);
	}
</style>

<div class="synapse-result-content">
	<div style="display: flex; justify-content: flex-end; margin-bottom: 1.5rem;">
		<span class="synapse-result-badge {% if report.all_critical_ok %}synapse-result-badge--success{% else %}synapse-result-badge--warning{% endif %}">
			{% if report.all_critical_ok %}✅ SUCCÈS{% else %}⚠️ VÉRIFICATION REQUISE
			{% endif %}
		</span>
	</div>

	<!-- Vérifications critiques -->
	<div class="synapse-result-section">
		<h2>
			<i data-lucide="shield-check"></i>
			Vérifications critiques</h2>
		<div style="display: grid; gap: 0.75rem;">
			<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--synapse-admin-bg-main); border-radius: 6px;">
				{% if report.critical_checks.response_not_empty %}✅{% else %}❌
				{% endif %}
				<span>La réponse de l'IA n'est pas vide</span>
			</div>
			<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--synapse-admin-bg-main); border-radius: 6px;">
				{% if report.critical_checks.debug_saved_in_db %}✅{% else %}❌
				{% endif %}
				<span>Debug enregistré (ID:
					{{ report.debug_id ?? '–' }})</span>
			</div>
			{% if report.critical_checks.streaming_enabled %}
				<div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--synapse-admin-bg-main); border-radius: 6px;">
					{% if report.critical_checks.streaming_works %}✅{% else %}⚠️
					{% endif %}
					<span>Mode streaming opérationnel</span>
				</div>
			{% endif %}
		</div>
	</div>

	<!-- Réponse IA -->
	<div class="synapse-result-section">
		<h2>
			<i data-lucide="message-square-text"></i>
			Réponse du LLM (Test)</h2>
		<div class="synapse-ai-response">{{ report.ai_response ?? 'Pas de réponse' }}</div>
		{% if report.ai_response_streaming %}
			<h3 style="font-size: 0.9rem; margin: 1rem 0 0.5rem 0;">Mode streaming</h3>
			<div class="synapse-ai-response">{{ report.ai_response_streaming }}</div>
		{% endif %}
	</div>

	<!-- Rapport d'analyse -->
	<div class="synapse-result-section">
		<h2>
			<i data-lucide="binary"></i>
			Rapport d'analyse expert</h2>
		<div id="analysis-rendered"></div>
		<details>
			<summary style="cursor:pointer; color: var(--synapse-admin-text-muted); font-size: 0.9rem;">Texte brut</summary>
			<pre id="analysis-raw" style="font-size: 11px; margin-top: 1rem; overflow: auto; padding: 1rem; background: #1f2937; color: white; border-radius: 4px;">{{ report.analysis }}</pre>
		</details>
	</div>

	<!-- Consommation -->
	<div class="synapse-result-section">
		<h2>
			<i data-lucide="activity"></i>
			Consommation</h2>
		<table class="usage-table">
			<thead>
				<tr>
					<th>Métrique</th>
					<th>Entrée</th>
					<th>Sortie</th>
					<th>Total</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Mode Sync</td>
					<td>{{ report.usage_test.prompt_tokens ?? 0 }}</td>
					<td>{{ report.usage_test.completion_tokens ?? 0 }}</td>
					<td>{{ report.usage_test.total_tokens ?? 0 }}</td>
				</tr>
				{% if report.usage_test_streaming %}
					<tr>
						<td>Streaming</td>
						<td>{{ report.usage_test_streaming.prompt_tokens ?? 0 }}</td>
						<td>{{ report.usage_test_streaming.completion_tokens ?? 0 }}</td>
						<td>{{ report.usage_test_streaming.total_tokens ?? 0 }}</td>
					</tr>
				{% endif %}
			</tbody>
		</table>
	</div>

	<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
		{% if report.debug_id %}
			<a href="{{ path('synapse_debug_show', {id: report.debug_id}) }}" target="_blank" class="synapse-admin__btn">
				<i data-lucide="bug"></i>
				Debug Sync
			</a>
		{% endif %}
		{% if report.debug_id_streaming %}
			<a href="{{ path('synapse_debug_show', {id: report.debug_id_streaming}) }}" target="_blank" class="synapse-admin__btn">
				<i data-lucide="bug"></i>
				Debug Stream
			</a>
		{% endif %}
	</div>
</div>
