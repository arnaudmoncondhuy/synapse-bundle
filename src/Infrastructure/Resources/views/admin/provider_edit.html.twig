{% extends '@Synapse/admin/layout.html.twig' %}

{% block admin_title %}{{ provider.label }} — Providers — Synapse Admin{% endblock %}

{% block admin_content %}
<div class="synapse-admin__page">
	<div class="synapse-admin__page-header">
		<div>
			<a href="{{ path('synapse_admin_providers') }}" class="synapse-admin__back-link">
				<i data-lucide="arrow-left"></i>
				Retour aux providers
			</a>
			<h1 class="synapse-admin__page-title">
				<i data-lucide="plug"></i>
				{{ provider.label }}
			</h1>
		</div>
	</div>

	<form method="post" action="{{ path('synapse_admin_providers_edit', {id: provider.id}) }}">
		<div class="synapse-admin__card">
			<div class="synapse-admin__card-header">
				<span class="synapse-admin__card-title">Informations générales</span>
			</div>
			<div class="synapse-admin__card-body">
				<div class="synapse-admin__form-row">
					<label class="synapse-admin__label">Nom affiché</label>
					<input type="text" name="label" value="{{ provider.label }}"
					       class="synapse-admin__input" required>
				</div>
				<div class="synapse-admin__form-row">
					<label class="synapse-admin__label">
						<input type="checkbox" name="is_enabled" value="1"
						       {% if provider.isEnabled %}checked{% endif %}>
						Provider activé
					</label>
					<p class="synapse-admin__help">Un provider désactivé ne peut pas être utilisé dans les presets.</p>
				</div>
			</div>
		</div>

		{# ── Credentials Gemini ──────────────────────────────────────────────── #}
		{% if provider.name == 'gemini' %}
			{% set creds = provider.credentials %}
			<div class="synapse-admin__card">
				<div class="synapse-admin__card-header">
					<span class="synapse-admin__card-title">
						<i data-lucide="zap" style="color: #4285f4"></i>
						Credentials Google Vertex AI
					</span>
				</div>
				<div class="synapse-admin__card-body">
					<div class="synapse-admin__form-row">
						<label class="synapse-admin__label">Project ID Google Cloud <span class="synapse-admin__required">*</span></label>
						<input type="text" name="project_id" value="{{ creds.project_id|default('') }}"
						       class="synapse-admin__input" placeholder="my-gcp-project">
						<p class="synapse-admin__help">Identifiant de votre projet Google Cloud Platform.</p>
					</div>
					<div class="synapse-admin__form-row">
						<label class="synapse-admin__label">Région Vertex AI <span class="synapse-admin__required">*</span></label>
						<select name="region" class="synapse-admin__select">
							{% for value, label in gemini_regions %}
								<option value="{{ value }}" {% if creds.region|default('europe-west1') == value %}selected{% endif %}>
									{{ label }}
								</option>
							{% endfor %}
						</select>
					</div>
					<div class="synapse-admin__form-row">
						<label class="synapse-admin__label">Service Account JSON <span class="synapse-admin__required">*</span></label>
						<textarea name="service_account_json"
						          class="synapse-admin__textarea synapse-admin__textarea--code"
						          rows="12"
						          placeholder='{"type": "service_account", "project_id": "...", "private_key": "...", ...}'>{{ creds.service_account_json|default('') }}</textarea>
						<p class="synapse-admin__help">
							Collez le contenu complet du fichier JSON du Service Account Google Cloud.
							Ce fichier est généré depuis <strong>IAM → Comptes de service → Clés</strong>.
						</p>
					</div>
				</div>
			</div>

		{# ── Credentials OVH ─────────────────────────────────────────────────── #}
		{% elseif provider.name == 'ovh' %}
			{% set creds = provider.credentials %}
			<div class="synapse-admin__card">
				<div class="synapse-admin__card-header">
					<span class="synapse-admin__card-title">
						<i data-lucide="cloud" style="color: #0050d8"></i>
						Credentials OVH AI Endpoints
					</span>
				</div>
				<div class="synapse-admin__card-body">
					<div class="synapse-admin__form-row">
						<label class="synapse-admin__label">API Key (Bearer Token) <span class="synapse-admin__required">*</span></label>
						<input type="password" name="api_key"
						       value="{{ creds.api_key|default('') }}"
						       class="synapse-admin__input"
						       placeholder="ovh_...">
						<p class="synapse-admin__help">Token d'authentification OVH AI Endpoints.</p>
					</div>
					<div class="synapse-admin__form-row">
						<label class="synapse-admin__label">Endpoint URL</label>
						<input type="text" name="endpoint"
						       value="{{ creds.endpoint|default('https://oai.endpoints.kepler.ai.cloud.ovh.net/v1') }}"
						       class="synapse-admin__input">
						<p class="synapse-admin__help">URL de base de l'API. Laisser la valeur par défaut sauf cas particulier.</p>
					</div>
				</div>
			</div>

		{# ── Credentials personnalisés ────────────────────────────────────────── #}
		{% else %}
			<div class="synapse-admin__card">
				<div class="synapse-admin__card-header">
					<span class="synapse-admin__card-title">Credentials (JSON)</span>
				</div>
				<div class="synapse-admin__card-body">
					<div class="synapse-admin__form-row">
						<label class="synapse-admin__label">Données JSON</label>
						<textarea name="credentials_raw"
						          class="synapse-admin__textarea synapse-admin__textarea--code"
						          rows="10">{{ provider.credentials|json_encode(constant('JSON_PRETTY_PRINT')) }}</textarea>
					</div>
				</div>
			</div>
		{% endif %}

		<div class="synapse-admin__form-actions">
			<button type="submit" class="synapse-admin__btn synapse-admin__btn--primary">
				<i data-lucide="save"></i>
				Enregistrer
			</button>
			<a href="{{ path('synapse_admin_providers') }}" class="synapse-admin__btn synapse-admin__btn--ghost">
				Annuler
			</a>
		</div>
	</form>
</div>
{% endblock %}
